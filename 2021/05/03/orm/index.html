<!DOCTYPE html>
<html lang="ch">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme-color" content=#58b77a>
  <title>ORMæ¡†æ¶ | ROBIN-3910</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="rob_æ›¾æ´›é•”">
  <meta name="keywords" content="">
  <meta name="description" content="robçš„ä¸ªäººåšå®¢ç½‘ç«™ï¼Œè®°å½•ç¼–ç /å­¦ä¹ /ç”Ÿæ´»æ—¥å¸¸">
  <script id="hexo-configurations">
  var CONFIG = {
    root: '/',
    theme: 'lx',
    version: '0.3.9',
    localsearch: {
      "enable": 'false',
      "trigger": "auto",
      "top_n_per_article": "1",
      "unescape": 'false',
      "preload": 'false'
    },
    path: '-'
  };
</script>

  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/theme-lx@0.3.9/source/css/main.min.css">
  <style type="text/css">
    pre,
    code {
      font-family: 'Fira Code', monospace;
    }
    html {
      font-family: sans-serif;
    }
    body {
      font-family: sans-serif;
    }
    h1, h2, h3, h4, h5, figure {
      font-family: sans-serif;
    }
    .menu-container{
      font-family: sans-serif;
    }
  </style>

  <script src="//cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/theme-lx@0.3.9/source/js/jquery.jside.menu.js"></script>
	<script>
	$(document).ready(function(){
	$(".menu-container").jSideMenu({
	    jSidePosition: "position-right",
	    jSideSticky: true,
	    jSideSkin: "greenish",
	     });
	}); 
	</script>
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Fira Code:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css">
<meta name="generator" content="Hexo 5.4.0"></head>
<body>
<div class="single">

<div id="page">
<div id="lx-aside" style="background-image: url(//cdn.jsdelivr.net/npm/theme-lx@0.3.9/source/images/post_cover.jpeg)" data-stellar-background-ratio="0.5">
  <div class="overlay">
  <div class="page-title">
    <div class="avatar"><a href="/"><img style="width: 100px;height: 100px;" src="/images/avatar.jpeg"></a></div>
    <span>2021-05-03</span>
    <h2>ORMæ¡†æ¶</h2>
    <div class="tags"><i class="fa fa-tag"></i><a class="tag-none-link" href="/tags/ORM/" rel="tag">ORM</a></div>
    <div class="social-links">
    <a href="https://github.com/Robin3910" target="_blank"><i class="fa fa-github fa-fw"></i></a>
    <a href="robin3910@163.com" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
</div></div>
</div>
</div>

<div id="lx-main-content">
  <div class="lx-post">
    <div class="lx-entry padding">
      <div>
        <h2 id="ä¸€ã€ORMç®€ä»‹"><a href="#ä¸€ã€ORMç®€ä»‹" class="headerlink" title="ä¸€ã€ORMç®€ä»‹"></a>ä¸€ã€ORMç®€ä»‹</h2><p><code>ORM</code>ï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼Œ<code>Object relational mapping</code>ï¼Œç®€ç§°<code>ORM</code>ï¼‰æ˜¯ä¸€ç§ä¸ºäº†è§£å†³ä¸šåŠ¡ä¸­å¯¹è±¡ä¸å…³ç³»æ•°æ®åº“ä¸åŒ¹é…çš„ç°è±¡è€Œæå‡ºçš„æ¡†æ¶æŠ€æœ¯ï¼Œ<code>ORM</code><br>é€šè¿‡ä½¿ç”¨æè¿°å¯¹è±¡å’Œæ•°æ®åº“ä¹‹é—´æ˜ å°„çš„å…ƒæ•°æ®ï¼Œå°†ä¸šåŠ¡é€»è¾‘ä¸­çš„å¯¹è±¡æŒä¹…åŒ–åˆ°å…³ç³»æ•°æ®åº“ä¸­ã€‚</p>
<pre><code>æŒä¹…åŒ–ï¼šæŒä¹…åŒ–æ˜¯å°†ç¨‹åºæ•°æ®åœ¨æŒä¹…çŠ¶æ€å’Œç¬æ—¶çŠ¶æ€é—´è½¬æ¢çš„æœºåˆ¶ï¼Œç¬æ—¶æ•°æ®æŒä¹…åŒ–ä¸ºæŒä¹…æ•°æ®ã€‚é€šä¿—æ˜“æ‡‚åœ°è®²å°±æ˜¯ï¼Œä¸šåŠ¡ä¸­å¤„ç†çš„å¯¹è±¡æ•°æ®å‘ç”Ÿæ”¹å˜ï¼Œ
</code></pre>
<p>éœ€è¦å°†å…¶åŒæ­¥åˆ°æ•°æ®åº“ä¸­ä¿å­˜ï¼Œå³<code>æŒä¹…åŒ–</code>ã€‚ï¼ˆæ¯”å¦‚å†…å­˜ä¸­çš„æ•°æ®ï¼Œæ˜¯ä¸èƒ½æ°¸ä¹…ä¿å­˜çš„ï¼ŒæŒä¹…åŒ–è‡³æ•°æ®åº“ä¸­ï¼Œèƒ½å¤Ÿé•¿ä¹…ä¿å­˜ï¼‰</p>
<p>å®ç°æŒä¹…åŒ–æœ€åŸºæœ¬çš„æ–¹å¼å°±æ˜¯ç¡¬ç¼–ç ï¼šä¸ºæ¯ä¸€ç§å¢åˆ æ”¹æŸ¥çš„éœ€æ±‚å†™ç›¸åº”çš„ä»£ç ã€‚å¯æƒ³è€ŒçŸ¥ï¼Œè¿™ç§æ–¹å¼å­˜åœ¨å¾ˆå¤šä¸è¶³çš„åœ°æ–¹ï¼š</p>
<ul>
<li><p>ç¼ºä¹å¼¹æ€§ï¼Œä¸€æ—¦ä¸šåŠ¡éœ€æ±‚å‘ç”Ÿå˜æ›´ï¼Œå°±å¿…é¡»ä¿®æ”¹ä»£ç ï¼Œæ‰©å±•æ€§ä»¥åŠå¯ç»´æŠ¤æ€§å·®ï¼›</p>
</li>
<li><p>é’ˆå¯¹äºæ¯ä¸€ç§æŒä¹…åŒ–éœ€æ±‚ï¼Œéƒ½éœ€è¦å†™ç›¸åº”çš„ä»£ç ï¼Œä½†å¾ˆå¤§ä¸€éƒ¨åˆ†ä»£ç éƒ½æ˜¯é‡å¤çš„ï¼›</p>
</li>
</ul>
<p>é’ˆå¯¹äºä»¥ä¸Šé—®é¢˜ï¼Œ<code>ORM</code>æ¡†æ¶å°±è¢«æå‡ºæ¥ã€‚<code>ORM</code>ä½œä¸ºä¸šåŠ¡å¤„ç†å¯¹è±¡ä¸æ•°æ®åº“è¿æ¥çš„æ¡¥æ¢ï¼Œé€šè¿‡å¯¹è±¡çš„è¯­æ³•ï¼Œå®Œæˆå…³ç³»å‹æ•°æ®åº“çš„æ“ä½œæŠ€æœ¯ã€‚</p>
<p><code>ORM</code> æŠŠæ•°æ®åº“æ˜ å°„æˆå¯¹è±¡ã€‚</p>
<ul>
<li><p>æ•°æ®åº“çš„è¡¨ï¼ˆ<code>table</code>ï¼‰ â€“&gt; ç±»ï¼ˆ<code>class</code>ï¼‰</p>
</li>
<li><p>è®°å½•ï¼ˆ<code>record</code>ï¼Œè¡Œæ•°æ®ï¼‰â€“&gt; å¯¹è±¡ï¼ˆ<code>object</code>ï¼‰</p>
</li>
<li><p>å­—æ®µï¼ˆ<code>field</code>ï¼‰â€“&gt; å¯¹è±¡çš„å±æ€§ï¼ˆ<code>attribute</code>ï¼‰</p>
</li>
</ul>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<p>sqlæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼Œ</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id, first_name, last_name, phone, birth_date, sex</span><br><span class="line"><span class="keyword">FROM</span> persons</span><br><span class="line"><span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>ä¸šåŠ¡é€»è¾‘ä¸­æ“ä½œæ•°æ®åº“ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res = db.execSql(sql);</span><br><span class="line">name = res[<span class="number">0</span>][<span class="string">&#x27;FIRST_NAME&#x27;</span>];</span><br></pre></td></tr></table></figure>

<p>æ”¹ç”¨<code>ORM</code>æ¡†æ¶ä¹‹åï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p = Person.get(<span class="number">10</span>);</span><br><span class="line"><span class="keyword">let</span> name = p.first_name;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä»¥ä¸Šä»£ç å¯¹æ¯”ï¼Œ<code>ORM</code>çš„ä¼˜ç‚¹å°±å‡¸æ˜¾å‡ºæ¥äº†ï¼šä¸šåŠ¡å¼€å‘è€…ä¸éœ€è¦å»ç¢°SQLè¯­å¥ï¼Œåªéœ€è¦ä½¿ç”¨<code>ORM</code>æä¾›çš„æ¥å£ï¼Œç›´æ¥å¯¹å¯¹è±¡è¿›è¡Œæ“ä½œï¼Œå°±å¯ä»¥å®ç°ä¸æ•°æ®åº“çš„äº¤äº’ï¼Œä¸éœ€è¦å…³å¿ƒæ•°æ®åº“åº•å±‚çš„å¢åˆ æ”¹æŸ¥SQLè¯­å¥ã€‚</p>
<h2 id="äºŒã€ORMä¼˜ç¼ºç‚¹"><a href="#äºŒã€ORMä¼˜ç¼ºç‚¹" class="headerlink" title="äºŒã€ORMä¼˜ç¼ºç‚¹"></a>äºŒã€ORMä¼˜ç¼ºç‚¹</h2><p><code>ORM</code>çš„ä¼˜ç‚¹ï¼š</p>
<ul>
<li><p>æ•°æ®æ¨¡å‹éƒ½åœ¨ä¸€ä¸ªåœ°æ–¹å®šä¹‰ï¼Œæ›´å®¹æ˜“æ›´æ–°å’Œç»´æŠ¤ï¼Œä¹Ÿåˆ©äºé‡ç”¨ä»£ç ã€‚</p>
</li>
<li><p><code>ORM</code> æœ‰ç°æˆçš„å·¥å…·ï¼Œå¾ˆå¤šåŠŸèƒ½éƒ½å¯ä»¥è‡ªåŠ¨å®Œæˆï¼Œæ¯”å¦‚æ•°æ®æ¶ˆæ¯’ã€é¢„å¤„ç†ã€äº‹åŠ¡ç­‰ç­‰ã€‚</p>
</li>
<li><p>å®ƒè¿«ä½¿ä½ ä½¿ç”¨ MVC æ¶æ„ï¼Œ<code>ORM</code> å°±æ˜¯å¤©ç„¶çš„ Modelï¼Œæœ€ç»ˆä½¿ä»£ç æ›´æ¸…æ™°ã€‚</p>
</li>
<li><p>åŸºäº <code>ORM</code> çš„ä¸šåŠ¡ä»£ç æ¯”è¾ƒç®€å•ï¼Œä»£ç é‡å°‘ï¼Œè¯­ä¹‰æ€§å¥½ï¼Œå®¹æ˜“ç†è§£ã€‚</p>
</li>
<li><p>ä¸å¿…ç¼–å†™æ€§èƒ½ä¸ä½³çš„ SQLã€‚</p>
</li>
</ul>
<p>ä½†æ˜¯<code>ORM</code>ä¹Ÿæœ‰ç›¸åº”çš„ç¼ºç‚¹ï¼š</p>
<ul>
<li><p><code>ORM</code> åº“ä¸æ˜¯è½»é‡çº§å·¥å…·ï¼Œéœ€è¦èŠ±å¾ˆå¤šç²¾åŠ›å­¦ä¹ å’Œè®¾ç½®ã€‚</p>
</li>
<li><p>å¯¹äºå¤æ‚çš„æŸ¥è¯¢ï¼Œ<code>ORM</code> è¦ä¹ˆæ˜¯æ— æ³•è¡¨è¾¾ï¼Œè¦ä¹ˆæ˜¯æ€§èƒ½ä¸å¦‚åŸç”Ÿçš„ SQLã€‚</p>
</li>
<li><p><code>ORM</code> æŠ½è±¡æ‰äº†æ•°æ®åº“å±‚ï¼Œå¼€å‘è€…æ— æ³•äº†è§£åº•å±‚çš„æ•°æ®åº“æ“ä½œï¼Œä¹Ÿæ— æ³•å®šåˆ¶ä¸€äº›ç‰¹æ®Šçš„ SQLã€‚</p>
</li>
</ul>
<h2 id="ä¸‰ã€ORMæ¡†æ¶"><a href="#ä¸‰ã€ORMæ¡†æ¶" class="headerlink" title="ä¸‰ã€ORMæ¡†æ¶"></a>ä¸‰ã€ORMæ¡†æ¶</h2><p>å®ç”¨<code>ORM</code>æ¡†æ¶ï¼š<a target="_blank" rel="noopener" href="https://sequelize.org/v5/">sequelize</a></p>
<p>è¿æ¥æ•°æ®åº“ï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Sequelize = <span class="built_in">require</span>(<span class="string">&#x27;sequelize&#x27;</span>);</span><br><span class="line"><span class="comment">// option1:</span></span><br><span class="line">sequelize = <span class="keyword">new</span> Sequelize(<span class="string">&#x27;database&#x27;</span>, <span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;password&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">host</span>: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">    <span class="attr">dialect</span>: <span class="string">&#x27;mysql&#x27;</span> | <span class="string">&#x27;mariadb&#x27;</span> | <span class="string">&#x27;postgres&#x27;</span> | <span class="string">&#x27;mssql&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="comment">// option2:</span></span><br><span class="line"><span class="keyword">const</span> sequelize = <span class="keyword">new</span> Sequelize(<span class="string">&#x27;mysql://root:asd123@localhost:3306/mydb&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;Sequelize, Model, DataTypes, BuildOptions&#125; <span class="keyword">from</span> <span class="string">&#x27;sequelize&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    HasManyGetAssociationsMixin,</span><br><span class="line">    HasManyAddAssociationMixin,</span><br><span class="line">    HasManyHasAssociationMixin,</span><br><span class="line">    Association,</span><br><span class="line">    HasManyCountAssociationsMixin,</span><br><span class="line">    HasManyCreateAssociationMixin</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;sequelize&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿æ¥æ•°æ®åº“</span></span><br><span class="line"><span class="keyword">const</span> sequelize = <span class="keyword">new</span> Sequelize(<span class="string">&#x27;mysql://root:asd123@localhost:3306/mydb&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®ä¸€ä¸ªUserè¡¨çš„æ“ä½œå¯¹è±¡</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> id!: <span class="built_in">number</span>; <span class="comment">// &#x27;!&#x27;éç©ºæ–­è¨€å¿…é¡»å¾—æœ‰</span></span><br><span class="line">    <span class="keyword">public</span> name!: <span class="built_in">string</span>;</span><br><span class="line">    <span class="keyword">public</span> preferredName!: <span class="built_in">string</span> | <span class="literal">null</span>; <span class="comment">// for nullable fields</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// timestampsæ—¶é—´æˆ³</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">readonly</span> createdAt!: <span class="built_in">Date</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">readonly</span> updatedAt!: <span class="built_in">Date</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¾ç½®å…³è”è¡¨</span></span><br><span class="line">    <span class="keyword">public</span> getProjects!: HasManyGetAssociationsMixin&lt;Project&gt;; <span class="comment">// Note the null assertions!</span></span><br><span class="line">    <span class="keyword">public</span> addProject!: HasManyAddAssociationMixin&lt;Project, <span class="built_in">number</span>&gt;;</span><br><span class="line">    <span class="keyword">public</span> hasProject!: HasManyHasAssociationMixin&lt;Project, <span class="built_in">number</span>&gt;;</span><br><span class="line">    <span class="keyword">public</span> countProjects!: HasManyCountAssociationsMixin;</span><br><span class="line">    <span class="keyword">public</span> createProject!: HasManyCreateAssociationMixin&lt;Project&gt;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">readonly</span> projects?: Project[]; <span class="comment">// Note this is optional since it&#x27;s only populated when explicitly requested in code</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> associations: &#123;</span><br><span class="line">        <span class="attr">projects</span>: Association&lt;User, Project&gt;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®Projectè¡¨</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Project</span> <span class="keyword">extends</span> <span class="title">Model</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> id!: <span class="built_in">number</span>;</span><br><span class="line">    <span class="keyword">public</span> ownerId!: <span class="built_in">number</span>;</span><br><span class="line">    <span class="keyword">public</span> name!: <span class="built_in">string</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">readonly</span> createdAt!: <span class="built_in">Date</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">readonly</span> updatedAt!: <span class="built_in">Date</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®Addressè¡¨</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Address</span> <span class="keyword">extends</span> <span class="title">Model</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> userId!: <span class="built_in">number</span>;</span><br><span class="line">    <span class="keyword">public</span> address!: <span class="built_in">string</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">readonly</span> createdAt!: <span class="built_in">Date</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">readonly</span> updatedAt!: <span class="built_in">Date</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–Projectè¡¨</span></span><br><span class="line">Project.init(&#123;</span><br><span class="line">    <span class="attr">id</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: DataTypes.INTEGER.UNSIGNED, <span class="comment">// you can omit the `new` but this is discouraged</span></span><br><span class="line">        <span class="attr">autoIncrement</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">primaryKey</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">ownerId</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: DataTypes.INTEGER.UNSIGNED,</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">name</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="keyword">new</span> DataTypes.STRING(<span class="number">128</span>),</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    sequelize,</span><br><span class="line">    <span class="attr">tableName</span>: <span class="string">&#x27;projects&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–Userè¡¨</span></span><br><span class="line">User.init(&#123;</span><br><span class="line">    <span class="attr">id</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: DataTypes.INTEGER.UNSIGNED,</span><br><span class="line">        <span class="attr">autoIncrement</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">primaryKey</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">name</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="keyword">new</span> DataTypes.STRING(<span class="number">128</span>),</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">preferredName</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="keyword">new</span> DataTypes.STRING(<span class="number">128</span>),</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="attr">tableName</span>: <span class="string">&#x27;users&#x27;</span>,</span><br><span class="line">    <span class="attr">sequelize</span>: sequelize,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–Addressè¡¨</span></span><br><span class="line">Address.init(&#123;</span><br><span class="line">    <span class="attr">userId</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: DataTypes.INTEGER.UNSIGNED,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">address</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="keyword">new</span> DataTypes.STRING(<span class="number">128</span>),</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="attr">tableName</span>: <span class="string">&#x27;address&#x27;</span>,</span><br><span class="line">    <span class="attr">sequelize</span>: sequelize, <span class="comment">// this bit is important</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸ºProjectè¡¨è®¾ç½®ä¸€ä¸ªå¤–é”®ownerIdç»‘å®šçº¦æŸåˆ°Userè¡¨ä¸­</span></span><br><span class="line">User.hasMany(Project, &#123;</span><br><span class="line">    <span class="attr">sourceKey</span>: <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">    <span class="attr">foreignKey</span>: <span class="string">&#x27;ownerId&#x27;</span>,</span><br><span class="line">    <span class="attr">as</span>: <span class="string">&#x27;projects&#x27;</span> <span class="comment">// this determines the name in `associations`!</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®Addressè¡¨çš„å¤–é”®çº¦æŸç»‘å®šåˆ°Userè¡¨çš„id</span></span><br><span class="line">Address.belongsTo(User, &#123;<span class="attr">targetKey</span>: <span class="string">&#x27;id&#x27;</span>&#125;);</span><br><span class="line">User.hasOne(Address, &#123;<span class="attr">sourceKey</span>: <span class="string">&#x27;id&#x27;</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æµ‹è¯•</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">stuff</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> newUser = <span class="keyword">await</span> User.create(&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;Johnny&#x27;</span>,</span><br><span class="line">        <span class="attr">preferredName</span>: <span class="string">&#x27;John&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(newUser.id, newUser.name, newUser.preferredName);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™ä¸ªfirst Projectè®°å½•ç”Ÿæˆæ—¶ä¼šä¸Userçš„idç»‘å®šï¼ŒownerIdå¯¹åº”Userè¡¨é‡Œçš„idè®°å½•ï¼Œè€ŒProjectçš„idä½œä¸ºç´¢å¼•è‡ªå¢</span></span><br><span class="line">    <span class="keyword">const</span> project = <span class="keyword">await</span> newUser.createProject(&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;first!&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// findByPk()ï¼Œå…¶ä¸­Pkä¸ºprimary_keyï¼Œå³userè¡¨çš„ç´¢å¼•IDï¼Œå¹¶ä¸”åˆ—å‡ºä¸è¯¥useræœ‰å…³çš„projects</span></span><br><span class="line">    <span class="keyword">const</span> ourUser = <span class="keyword">await</span> User.findByPk(<span class="number">1</span>, &#123;</span><br><span class="line">        <span class="attr">include</span>: [User.associations.projects],</span><br><span class="line">        <span class="attr">rejectOnEmpty</span>: <span class="literal">true</span>, <span class="comment">// Specifying true here removes `null` from the return type!</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(ourUser.projects![<span class="number">0</span>].name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>















      </div>
    </div>
  </div>
</div>
<div class="lx-navigation">
	<div class="lx-cover prev lx-cover-sm" style="background-image: url(//cdn.jsdelivr.net/npm/theme-lx@0.3.9/source/images/footer-l.jpeg)">
		<div class="overlay"></div>
		<a class="copy" href="/2021/05/05/okr-record/">
			<div class="display-t">
				<div class="display-tc">
					<div>
						<span>Next</span>
						<h3>OKRé˜…è¯»å¿ƒå¾—</h3>
					</div>
				</div>
			</div>
		</a>
	</div>
        <div class="lx-cover next lx-cover-sm" style="background-image: url(//cdn.jsdelivr.net/npm/theme-lx@0.3.9/source/images/footer-r.jpeg)">
		<div class="overlay"></div>
		<a class="copy" href="/2021/05/01/ts-notes/">
			<div class="display-t">
				<div class="display-tc">
					<div>
						<span>Prev</span>
						<h3>tséšç¬”</h3>
					</div>
				</div>
			</div>
		</a>
	</div>
</div>

</div>

<footer>
  <div>
  Copyright &copy; 2021.<a href="/">ROBIN-3910</a><br>Powered by <a href="https://hexo.io" target="_blank">Hexo</a> | Theme <a href="https://lx.js.org" target="_blank">Lx</a><br>
  </div>
</footer>

</div>

<button class="hamburger hamburger--arrow-r" type="button">
    <div class="hamburger-box">
      <div class="hamburger-inner"></div>
    </div>
</button> 
<div class="menu visibility">
  <div class="menu-head">
    <span class="layer">
      <div class="col">
        <div class="row for-pic">
          <div class="profile-pic">
            <a href="/"><img src="/images/avatar.jpeg" alt="rob_æ›¾æ´›é•”"/></a>
          </div>
        </div>
        <div class="row for-name">
          <p>rob_æ›¾æ´›é•”</p>
          <span class="tagline">ç¥ä½ æš´å¯ŒğŸ¤©</span>
        </div>
      </div>
    </span>
  </div>
  <nav class="menu-container">
  <ul class="menu-items">
    <li><a href="/"><i class="fa fa-home fa-fw"></i>Home</a></li>
    <li><a href="/archives/"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
    
    
    
  </ul>
  </nav>
</div>

<div class="gototop js-top">
  <a href="#" class="js-gotop"><i class="fa fa-arrow-up"></i></a>
</div>
<script src="//cdn.jsdelivr.net/npm/theme-lx@0.3.9/source/js/jquery.easing.min.js"></script>
<script>
(function () {
	"use strict";
	var goToTop = function() {
		$(".js-gotop").on("click", function(event){
			event.preventDefault();
			$("html, body").animate({
				scrollTop: $("html").offset().top
			}, 500, "easeInOutExpo");
			return false;
		});
		$(window).scroll(function(){
			var $win = $(window);
			if ($win.scrollTop() > 200) {
				$(".js-top").addClass("active");
			} else {
				$(".js-top").removeClass("active");
			}
		});
	};
	$(function(){
		goToTop();
	});
}());
</script>


</body>
</html>
